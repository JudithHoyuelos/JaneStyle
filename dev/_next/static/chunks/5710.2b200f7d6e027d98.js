(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5710],{9986:function(e,t,i){i(2201),i(5740),i(5722),i(2197),i(9420)},7813:function(e){e.exports=THREE.ColladaLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(e,t,i,n){var r=this,o=void 0===r.path?THREE.LoaderUtils.extractUrlBase(e):r.path,a=new THREE.FileLoader(r.manager);a.setPath(r.path),a.load(e,function(e){t(r.parse(e,o))},i,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},options:{set convertUpAxis(value){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){function i(e,t){for(var i=[],n=e.childNodes,r=0,o=n.length;r<o;r++){var a=n[r];a.nodeName===t&&i.push(a)}return i}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=Array(t.length),n=0,r=t.length;n<r;n++)i[n]=parseFloat(t[n]);return i}function r(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=Array(t.length),n=0,r=t.length;n<r;n++)i[n]=parseInt(t[n]);return i}function o(e){return e.substring(1)}function a(e){return 0===Object.keys(e).length}function s(e,t,n,r){var o=i(e,t)[0];if(void 0!==o)for(var a=i(o,n),s=0;s<a.length;s++)r(a[s])}function l(e,t){for(var i in e)e[i].build=t(e[i])}function c(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function h(e){var t=[],i=e.channels,n=e.samplers,r=e.sources;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o],s=n[a.sampler],l=s.inputs.INPUT,c=s.inputs.OUTPUT;(function(e,t){for(var i=e.keyframes,n=e.name,r=[],o=[],a=[],s=[],l=0,c=i.length;l<c;l++){var h=i[l],d=h.time,u=h.value;_.fromArray(u).transpose(),_.decompose(y,b,g),r.push(d),o.push(y.x,y.y,y.z),a.push(b.x,b.y,b.z,b.w),s.push(g.x,g.y,g.z)}o.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".position",r,o)),a.length>0&&t.push(new THREE.QuaternionKeyframeTrack(n+".quaternion",r,a)),s.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".scale",r,s))})(function(e,t,i){var n,r,o,a,s,l,c=ee.nodes[e.id],h=G(c.id),d=c.transforms[e.sid],u=c.matrix.clone().transpose(),p={};switch(d){case"matrix":for(o=0,a=t.array.length;o<a;o++)if(n=t.array[o],r=o*i.stride,void 0===p[n]&&(p[n]={}),!0===e.arraySyntax){var f=i.array[r],m=e.indices[0]+4*e.indices[1];p[n][m]=f}else for(s=0,l=i.stride;s<l;s++)p[n][s]=i.array[r+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',d)}var v=function(e,t){var i=[];for(var n in e)i.push({time:parseFloat(n),value:e[n]});i.sort(function(e,t){return e.time-t.time});for(var r=0;r<16;r++)(function(e,t,i){var n,r,o,a=!0;for(r=0,o=e.length;r<o;r++)void 0===(n=e[r]).value[t]?n.value[t]=null:a=!1;if(!0===a)for(r=0,o=e.length;r<o;r++)(n=e[r]).value[t]=i;else(function(e,t){for(var i,n,r=0,o=e.length;r<o;r++){var a=e[r];if(null===a.value[t]){if(i=function(e,t,i){for(;t>=0;){var n=e[t];if(null!==n.value[i])return n;t--}return null}(e,r,t),n=function(e,t,i){for(;t<e.length;){var n=e[t];if(null!==n.value[i])return n;t++}return null}(e,r,t),null===i){a.value[t]=n.value[t];continue}if(null===n){a.value[t]=i.value[t];continue}(function(e,t,i,n){if(i.time-t.time==0){e.value[n]=t.value[n];return}e.value[n]=(e.time-t.time)*(i.value[n]-t.value[n])/(i.time-t.time)+t.value[n]})(a,i,n,t)}}})(e,t)})(i,r,t.elements[r]);return i}(p,u);return{name:h.uuid,keyframes:v}}(a,r[l],r[c]),t)}return t}function d(e){return c(ee.animations[e],h)}var u,p,f,m,v,y=new THREE.Vector3,g=new THREE.Vector3,b=new THREE.Quaternion;function w(e){for(var t=[],i=e.name,n=e.end-e.start||-1,r=e.animations,o=0,a=r.length;o<a;o++)for(var s=d(r[o]),l=0,c=s.length;l<c;l++)t.push(s[l]);return new THREE.AnimationClip(i,n,t)}function E(e){var t={id:e.id},i=ee.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,i,n,r={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=e.sources,a=e.vertexWeights,s=a.vcount,l=a.v,c=a.inputs.JOINT.offset,h=a.inputs.WEIGHT.offset,d=e.sources[e.joints.inputs.JOINT],u=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=o[a.inputs.WEIGHT.id].array,f=0;for(t=0,n=s.length;t<n;t++){var m=s[t],v=[];for(i=0;i<m;i++){var y=l[f+c],g=p[l[f+h]];v.push({index:y,weight:g}),f+=2}for(v.sort(k),i=0;i<4;i++){var b=v[i];void 0!==b?(r.indices.array.push(b.index),r.weights.array.push(b.weight)):(r.indices.array.push(0),r.weights.array.push(0))}}for(e.bindShapeMatrix?r.bindMatrix=new THREE.Matrix4().fromArray(e.bindShapeMatrix).transpose():r.bindMatrix=new THREE.Matrix4().identity(),t=0,n=d.array.length;t<n;t++){var w=d.array[t],E=new THREE.Matrix4().fromArray(u.array,t*u.stride).transpose();r.joints.push({name:w,boneInverse:E})}return r;function k(e,t){return t.weight-e.weight}}(e.skin),i.sources.skinIndices=t.skin.indices,i.sources.skinWeights=t.skin.weights),t}function k(e){return void 0!==e.build?e.build:e.init_from}function x(e){var t=ee.images[e];return void 0!==t?c(t,k):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function T(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=n(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:function(e){for(var t={technique:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"extra"===r.nodeName&&function(e,t){for(var i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"technique"===r.nodeName&&function(e,t){for(var i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=1:"FALSE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=0:t.technique[r.nodeName]=parseInt(r.textContent)}}}(r,t)}}(r,t)}return t}(o)}}}return t}function A(e){return e}function M(e){var t,i,n=(t=e.url,c(ee.effects[t],A)),r=n.profile.technique,o=n.profile.extra;switch(r.type){case"phong":case"blinn":i=new THREE.MeshPhongMaterial;break;case"lambert":i=new THREE.MeshLambertMaterial;break;default:i=new THREE.MeshBasicMaterial}function s(e){var t,i,r,o=n.profile.samplers[e.id],s=null;if(void 0!==o?s=x(n.profile.surfaces[o.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),s=x(e.id)),null===s)return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null;var l="tga"===(t=s).slice((t.lastIndexOf(".")-1>>>0)+2).toLowerCase()?v:Z;if(void 0===l)return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",s),null;var c=l.load(s),h=e.extra;if(void 0!==h&&void 0!==h.technique&&!1===a(h.technique)){var d=h.technique;c.wrapS=d.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,c.wrapT=d.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,c.offset.set(d.offsetU||0,d.offsetV||0),c.repeat.set(d.repeatU||1,d.repeatV||1)}else c.wrapS=THREE.RepeatWrapping,c.wrapT=THREE.RepeatWrapping;return c}i.name=e.name;var l=r.parameters;for(var h in l){var d=l[h];switch(h){case"diffuse":d.color&&i.color.fromArray(d.color),d.texture&&(i.map=s(d.texture));break;case"specular":d.color&&i.specular&&i.specular.fromArray(d.color),d.texture&&(i.specularMap=s(d.texture));break;case"bump":d.texture&&(i.normalMap=s(d.texture));break;case"ambient":d.texture&&(i.lightMap=s(d.texture));break;case"shininess":d.float&&i.shininess&&(i.shininess=d.float);break;case"emission":d.color&&i.emissive&&i.emissive.fromArray(d.color),d.texture&&(i.emissiveMap=s(d.texture))}}var u=l.transparent,p=l.transparency;if(void 0===p&&u&&(p={float:1}),void 0===u&&p&&(u={opaque:"A_ONE",data:{color:[1,1,1,1]}}),u&&p){if(u.data.texture)i.transparent=!0;else{var f=u.data.color;switch(u.opaque){case"A_ONE":i.opacity=f[3]*p.float;break;case"RGB_ZERO":i.opacity=1-f[0]*p.float;break;case"A_ZERO":i.opacity=1-f[3]*p.float;break;case"RGB_ONE":i.opacity=f[0]*p.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',u.opaque)}i.opacity<1&&(i.transparent=!0)}}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(i.side=THREE.DoubleSide),i}function N(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var i=e.optics.parameters.ymag,n=e.optics.parameters.xmag,r=e.optics.parameters.aspect_ratio;n=void 0===n?i*r:n,i=void 0===i?n/r:i,n*=.5,i*=.5,t=new THREE.OrthographicCamera(-n,n,i,-i,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name,t}function C(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function R(e){for(var t={array:[],stride:3},r=0;r<e.childNodes.length;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=n(o.textContent);break;case"Name_array":t.array=function(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=Array(t.length),n=0,r=t.length;n<r;n++)i[n]=t[n];return i}(o.textContent);break;case"technique_common":var a=i(o,"accessor")[0];void 0!==a&&(t.stride=parseInt(a.getAttribute("stride")))}}return t}function O(e){var t={},i=e.sources,n=e.vertices,r=e.primitives;if(0===r.length)return{};var o=function(e){for(var t={},i=0;i<e.length;i++){var n=e[i];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(r);for(var a in o){var s=o[a];(function(e){for(var t=0,i=0,n=e.length;i<n;i++)!0===e[i].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)})(s),t[a]=function(e,t,i){for(var n={},r={array:[],stride:0},o={array:[],stride:0},a={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c={array:[],stride:4},h={array:[],stride:4},d=new THREE.BufferGeometry,u=[],p=0,f=0;f<e.length;f++){var m=e[f],v=m.inputs,y=0;switch(m.type){case"lines":case"linestrips":y=2*m.count;break;case"triangles":y=3*m.count;break;case"polylist":for(var g=0;g<m.count;g++){var b=m.vcount[g];switch(b){case 3:y+=3;break;case 4:y+=6;break;default:y+=(b-2)*3}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",m.type)}for(var w in d.addGroup(p,y,f),p+=y,m.material&&u.push(m.material),v){var E=v[w];switch(w){case"VERTEX":for(var k in i){var x=i[k];switch(k){case"POSITION":var T=r.array.length;if(D(m,t[x],E.offset,r.array),r.stride=t[x].stride,t.skinWeights&&t.skinIndices&&(D(m,t.skinIndices,E.offset,c.array),D(m,t.skinWeights,E.offset,h.array)),!1===m.hasUV&&!0===e.uvsNeedsFix)for(var y=(r.array.length-T)/r.stride,A=0;A<y;A++)a.array.push(0,0);break;case"NORMAL":D(m,t[x],E.offset,o.array),o.stride=t[x].stride;break;case"COLOR":D(m,t[x],E.offset,l.array),l.stride=t[x].stride;break;case"TEXCOORD":D(m,t[x],E.offset,a.array),a.stride=t[x].stride;break;case"TEXCOORD1":D(m,t[x],E.offset,s.array),a.stride=t[x].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',k)}}break;case"NORMAL":D(m,t[E.id],E.offset,o.array),o.stride=t[E.id].stride;break;case"COLOR":D(m,t[E.id],E.offset,l.array),l.stride=t[E.id].stride;break;case"TEXCOORD":D(m,t[E.id],E.offset,a.array),a.stride=t[E.id].stride;break;case"TEXCOORD1":D(m,t[E.id],E.offset,s.array),s.stride=t[E.id].stride}}}return r.array.length>0&&d.addAttribute("position",new THREE.Float32BufferAttribute(r.array,r.stride)),o.array.length>0&&d.addAttribute("normal",new THREE.Float32BufferAttribute(o.array,o.stride)),l.array.length>0&&d.addAttribute("color",new THREE.Float32BufferAttribute(l.array,l.stride)),a.array.length>0&&d.addAttribute("uv",new THREE.Float32BufferAttribute(a.array,a.stride)),s.array.length>0&&d.addAttribute("uv2",new THREE.Float32BufferAttribute(s.array,s.stride)),c.array.length>0&&d.addAttribute("skinIndex",new THREE.Float32BufferAttribute(c.array,c.stride)),h.array.length>0&&d.addAttribute("skinWeight",new THREE.Float32BufferAttribute(h.array,h.stride)),n.data=d,n.type=e[0].type,n.materialKeys=u,n}(s,i,n)}return t}function D(e,t,i,n){var r=e.p,o=e.stride,a=e.vcount;function s(e){for(var t=r[e+i]*c,o=t+c;t<o;t++)n.push(l[t])}var l=t.array,c=t.stride;if(void 0!==e.vcount)for(var h=0,d=0,u=a.length;d<u;d++){var p=a[d];if(4===p){var f=h+0*o,m=h+1*o,v=h+2*o,y=h+3*o;s(f),s(m),s(y),s(m),s(v),s(y)}else if(3===p){var f=h+0*o,m=h+1*o,v=h+2*o;s(f),s(m),s(v)}else if(p>4)for(var g=1,b=p-2;g<=b;g++){var f=h+0*o,m=h+o*g,v=h+o*(g+1);s(f),s(m),s(v)}h+=o*p}else for(var d=0,u=r.length;d<u;d+=o)s(d)}function S(e){return c(ee.geometries[e],O)}function I(e){return void 0!==e.build?e.build:e}function L(e){var t={type:e.nodeName},i=n(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(i).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(i);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(i),t.angle=THREE.MathUtils.degToRad(i[3])}return t}function P(e){return void 0!==e.build?e.build:e}var _=new THREE.Matrix4,F=new THREE.Vector3;function H(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"node":t.nodes.push(r.getAttribute("id")),H(r);break;case"instance_camera":t.instanceCameras.push(o(r.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(U(r));break;case"instance_light":t.instanceLights.push(o(r.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(U(r));break;case"instance_node":t.instanceNodes.push(o(r.getAttribute("url")));break;case"matrix":var a=n(r.textContent);t.matrix.multiply(_.fromArray(a).transpose()),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":var a=n(r.textContent);F.fromArray(a),t.matrix.multiply(_.makeTranslation(F.x,F.y,F.z)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":var a=n(r.textContent),s=THREE.MathUtils.degToRad(a[3]);t.matrix.multiply(_.makeRotationAxis(F.fromArray(a),s)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":var a=n(r.textContent);t.matrix.scale(F.fromArray(a)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"extra":break;default:console.log(r)}}return B(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):ee.nodes[t.id]=t,t}function U(e){for(var t={id:o(e.getAttribute("url")),materials:{},skeletons:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];switch(n.nodeName){case"bind_material":for(var r=n.getElementsByTagName("instance_material"),a=0;a<r.length;a++){var s=r[a],l=s.getAttribute("symbol"),c=s.getAttribute("target");t.materials[l]=o(c)}break;case"skeleton":t.skeletons.push(o(n.textContent))}}return t}function V(e,t,i){e.traverse(function(e){if(!0===e.isBone){for(var n,r=0;r<t.length;r++){var o=t[r];if(o.name===e.name){n=o.boneInverse;break}}void 0===n&&(n=new THREE.Matrix4),i.push({bone:e,boneInverse:n,processed:!1})}})}function z(e){for(var t,i=[],n=e.matrix,r=e.nodes,o=e.type,a=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,h=e.instanceGeometries,d=e.instanceNodes,u=0,p=r.length;u<p;u++)i.push(G(r[u]));for(var u=0,p=a.length;u<p;u++){var f=function(e){var t=ee.cameras[e];return void 0!==t?c(t,N):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}(a[u]);null!==f&&i.push(f.clone())}for(var u=0,p=s.length;u<p;u++)for(var m,v=s[u],y=(m=v.id,c(ee.controllers[m],E)),g=S(y.id),b=K(g,v.materials),w=function(e,t){var i=[],n=[];for(r=0;r<e.length;r++){var r,o,a,s,l=e[r];if(B(l))V(s=G(l),t,i);else if(void 0!==ee.visualScenes[l])for(var c=ee.visualScenes[l].children,o=0;o<c.length;o++){var h=c[o];if("JOINT"===h.type){var s=G(h.id);V(s,t,i)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",l)}for(r=0;r<t.length;r++)for(o=0;o<i.length;o++)if((a=i[o]).bone.name===t[r].name){n[r]=a,a.processed=!0;break}for(r=0;r<i.length;r++)!1===(a=i[r]).processed&&(n.push(a),a.processed=!0);var d=[],u=[];for(r=0;r<n.length;r++)a=n[r],d.push(a.bone),u.push(a.boneInverse);return new THREE.Skeleton(d,u)}(v.skeletons,y.skin.joints),k=0,x=b.length;k<x;k++){var t=b[k];t.isSkinnedMesh&&(t.bind(w,y.skin.bindMatrix),t.normalizeSkinWeights()),i.push(t)}for(var u=0,p=l.length;u<p;u++){var T=function(e){var t=ee.lights[e];return void 0!==t?c(t,C):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}(l[u]);null!==T&&i.push(T.clone())}for(var u=0,p=h.length;u<p;u++)for(var v=h[u],g=S(v.id),b=K(g,v.materials),k=0,x=b.length;k<x;k++)i.push(b[k]);for(var u=0,p=d.length;u<p;u++)i.push(G(d[u]).clone());if(0===r.length&&1===i.length)t=i[0];else{t="JOINT"===o?new THREE.Bone:new THREE.Group;for(var u=0;u<i.length;u++)t.add(i[u])}return""===t.name&&(t.name="JOINT"===o?e.sid:e.name),t.matrix.copy(n),t.matrix.decompose(t.position,t.quaternion,t.scale),t}var j=new THREE.MeshBasicMaterial({color:16711935});function K(e,t){var i=[];for(var n in e){var r,o=e[n],a=function(e,t){for(var i=[],n=0,r=e.length;n<r;n++){var o=t[e[n]];void 0===o?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),i.push(j)):i.push(c(ee.materials[o],M))}return i}(o.materialKeys,t);0===a.length&&("lines"===n||"linestrips"===n?a.push(new THREE.LineBasicMaterial):a.push(new THREE.MeshPhongMaterial));var s=void 0!==o.data.attributes.skinIndex;if(s)for(var l=0,h=a.length;l<h;l++)a[l].skinning=!0;var d=1===a.length?a[0]:a;switch(n){case"lines":r=new THREE.LineSegments(o.data,d);break;case"linestrips":r=new THREE.Line(o.data,d);break;case"triangles":case"polylist":r=s?new THREE.SkinnedMesh(o.data,d):new THREE.Mesh(o.data,d)}i.push(r)}return i}function B(e){return void 0!==ee.nodes[e]}function G(e){return c(ee.nodes[e],z)}function X(e){var t=new THREE.Group;t.name=e.name;for(var i=e.children,n=0;n<i.length;n++){var r=i[n];t.add(G(r.id))}return t}function W(e){return c(ee.visualScenes[e],X)}if(0===e.length)return{scene:new THREE.Scene};var q=i(new DOMParser().parseFromString(e,"application/xml"),"COLLADA")[0];console.log("THREE.ColladaLoader: File version",q.getAttribute("version"));var J=(f=i(q,"asset")[0],{unit:void 0!==(u=i(f,"unit")[0])&&!0===u.hasAttribute("meter")?parseFloat(u.getAttribute("meter")):1,upAxis:void 0!==(p=i(f,"up_axis")[0])?p.textContent:"Y_UP"}),Z=new THREE.TextureLoader(this.manager);Z.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(v=new THREE.TGALoader(this.manager)).setPath(this.resourcePath||t);var Y=[],$={},Q=0,ee={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};s(q,"library_animations","animation",function(e){for(var t={sources:{},samplers:{},channels:{}},i=0,n=e.childNodes.length;i<n;i++){var r,a=e.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"source":r=a.getAttribute("id"),t.sources[r]=R(a);break;case"sampler":r=a.getAttribute("id"),t.samplers[r]=function(e){for(var t={inputs:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType&&"input"===r.nodeName){var a=o(r.getAttribute("source")),s=r.getAttribute("semantic");t.inputs[s]=a}}return t}(a);break;case"channel":r=a.getAttribute("target"),t.channels[r]=function(e){var t={},i=e.getAttribute("target").split("/"),n=i.shift(),r=i.shift(),a=-1!==r.indexOf("("),s=-1!==r.indexOf(".");if(s)r=(i=r.split(".")).shift(),t.member=i.shift();else if(a){var l=r.split("(");r=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));t.indices=l}return t.id=n,t.sid=r,t.arraySyntax=a,t.memberSyntax=s,t.sampler=o(e.getAttribute("source")),t}(a);break;default:console.log(a)}}ee.animations[e.getAttribute("id")]=t}),s(q,"library_animation_clips","animation_clip",function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"instance_animation"===r.nodeName&&t.animations.push(o(r.getAttribute("url")))}ee.clips[e.getAttribute("id")]=t}),s(q,"library_controllers","controller",function(e){for(var t={},i=0,a=e.childNodes.length;i<a;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"skin":t.id=o(s.getAttribute("source")),t.skin=function(e){for(var t={sources:{}},i=0,a=e.childNodes.length;i<a;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=n(s.textContent);break;case"source":var l=s.getAttribute("id");t.sources[l]=R(s);break;case"joints":t.joints=function(e){for(var t={inputs:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType&&"input"===r.nodeName){var a=r.getAttribute("semantic"),s=o(r.getAttribute("source"));t.inputs[a]=s}}return t}(s);break;case"vertex_weights":t.vertexWeights=function(e){for(var t={inputs:{}},i=0,n=e.childNodes.length;i<n;i++){var a=e.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"input":var s=a.getAttribute("semantic"),l=o(a.getAttribute("source")),c=parseInt(a.getAttribute("offset"));t.inputs[s]={id:l,offset:c};break;case"vcount":t.vcount=r(a.textContent);break;case"v":t.v=r(a.textContent)}}return t}(s)}}return t}(s);break;case"morph":t.id=o(s.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}ee.controllers[e.getAttribute("id")]=t}),s(q,"library_images","image",function(e){var t={init_from:i(e,"init_from")[0].textContent};ee.images[e.getAttribute("id")]=t}),s(q,"library_effects","effect",function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"profile_COMMON"===r.nodeName&&(t.profile=function(e){for(var t={surfaces:{},samplers:{}},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"newparam":(function(e,t){for(var i=e.getAttribute("sid"),n=0,r=e.childNodes.length;n<r;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[i]=function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"init_from"===r.nodeName&&(t.init_from=r.textContent)}return t}(o);break;case"sampler2D":t.samplers[i]=function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"source"===r.nodeName&&(t.source=r.textContent)}return t}(o)}}})(r,t);break;case"technique":t.technique=function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=r.nodeName,t.parameters=function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[r.nodeName]=T(r);break;case"transparent":t[r.nodeName]={opaque:r.getAttribute("opaque"),data:T(r)}}}return t}(r)}}return t}(r);break;case"extra":t.extra=function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"technique"===r.nodeName&&(t.technique=function(e){for(var t={},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"double_sided"===r.nodeName&&(t[r.nodeName]=parseInt(r.textContent))}return t}(r))}return t}(r)}}return t}(r))}ee.effects[e.getAttribute("id")]=t}),s(q,"library_materials","material",function(e){for(var t={name:e.getAttribute("name")},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"instance_effect"===r.nodeName&&(t.url=o(r.getAttribute("url")))}ee.materials[e.getAttribute("id")]=t}),s(q,"library_cameras","camera",function(e){for(var t={name:e.getAttribute("name")},i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&"optics"===r.nodeName&&(t.optics=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if("technique_common"===i.nodeName)return function(e){for(var t={},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=function(e){for(var t={},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}(n)}}return t}(i)}return{}}(r))}ee.cameras[e.getAttribute("id")]=t}),s(q,"library_lights","light",function(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];1===o.nodeType&&"technique_common"===o.nodeName&&(t=function(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=o.nodeName,t.parameters=function(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":var a=n(o.textContent);t.color=new THREE.Color().fromArray(a);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var s=parseFloat(o.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}(o)}}return t}(o))}ee.lights[e.getAttribute("id")]=t}),s(q,"library_geometries","geometry",function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=i(e,"mesh")[0];if(void 0!==n){for(var a=0;a<n.childNodes.length;a++){var s=n.childNodes[a];if(1===s.nodeType){var l=s.getAttribute("id");switch(s.nodeName){case"source":t.sources[l]=R(s);break;case"vertices":t.vertices=function(e){for(var t={},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&(t[n.getAttribute("semantic")]=o(n.getAttribute("source")))}return t}(s);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",s.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(function(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},i=0,n=e.childNodes.length;i<n;i++){var a=e.childNodes[i];if(1===a.nodeType)switch(a.nodeName){case"input":var s=o(a.getAttribute("source")),l=a.getAttribute("semantic"),c=parseInt(a.getAttribute("offset")),h=parseInt(a.getAttribute("set")),d=h>0?l+h:l;t.inputs[d]={id:s,offset:c},t.stride=Math.max(t.stride,c+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=r(a.textContent);break;case"p":t.p=r(a.textContent)}}return t}(s));break;default:console.log(s)}}}ee.geometries[e.getAttribute("id")]=t}}),s(q,"library_nodes","node",H),s(q,"library_visual_scenes","visual_scene",function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),i=0;i<t.length;i++){var n=t[i];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+Q++)}}(e);for(var n=i(e,"node"),r=0;r<n.length;r++)t.children.push(H(n[r]));ee.visualScenes[e.getAttribute("id")]=t}),s(q,"library_kinematics_models","kinematics_model",function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];1===r.nodeType&&"technique_common"===r.nodeName&&function(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"joint":t.joints[r.getAttribute("sid")]=function(e){for(var t,i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":t=function(e,t){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"axis":var o=n(r.textContent);t.axis.fromArray(o);break;case"limits":var a=r.getElementsByTagName("max")[0],s=r.getElementsByTagName("min")[0];t.limits.max=parseFloat(a.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}(r)}}return t}(r);break;case"link":t.links.push(function e(t){for(var i={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":i.attachments.push(function(t){for(var i={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]},n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"link":i.links.push(e(r));break;case"matrix":case"translate":case"rotate":i.transforms.push(L(r))}}return i}(r));break;case"matrix":case"translate":case"rotate":i.transforms.push(L(r))}}return i}(r))}}}(r,t)}ee.kinematicsModels[e.getAttribute("id")]=t}),s(q,"library_physics_models","physics_model",function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];1===r.nodeType&&"rigid_body"===r.nodeName&&(t.rigidBodies[r.getAttribute("name")]={},function(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];1===r.nodeType&&"technique_common"===r.nodeName&&function(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"inertia":t.inertia=n(r.textContent);break;case"mass":t.mass=n(r.textContent)[0]}}}(r,t)}}(r,t.rigidBodies[r.getAttribute("name")]))}ee.physicsModels[e.getAttribute("id")]=t}),s(q,"scene","instance_kinematics_scene",function(e){for(var t={bindJointAxis:[]},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];1===n.nodeType&&"bind_joint_axis"===n.nodeName&&t.bindJointAxis.push(function(e){for(var t={target:e.getAttribute("target").split("/").pop()},i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1===n.nodeType&&"axis"===n.nodeName){var r=n.getElementsByTagName("param")[0];t.axis=r.textContent;var o=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=o.substr(0,o.length-1)}}return t}(n))}ee.kinematicsScenes[o(e.getAttribute("url"))]=t}),l(ee.animations,h),l(ee.clips,w),l(ee.controllers,E),l(ee.images,k),l(ee.effects,A),l(ee.materials,M),l(ee.cameras,N),l(ee.lights,C),l(ee.geometries,O),l(ee.visualScenes,X),function(){var e=ee.clips;if(!0===a(e)){if(!1===a(ee.animations)){var t=[];for(var i in ee.animations)for(var n=d(i),r=0,o=n.length;r<o;r++)t.push(n[r]);Y.push(new THREE.AnimationClip("default",-1,t))}}else for(var i in e)Y.push(c(ee.clips[i],w))}(),function(){var e=Object.keys(ee.kinematicsModels)[0],t=Object.keys(ee.kinematicsScenes)[0],i=Object.keys(ee.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var r=c(ee.kinematicsModels[e],I),o=c(ee.kinematicsScenes[t],P),a=W(i),s=o.bindJointAxis,l={},h=0,d=s.length;h<d;h++){var u=s[h],p=q.querySelector('[sid="'+u.target+'"]');if(p){var f=p.parentElement;(function(e,t){var i=t.getAttribute("name"),o=r.joints[e];a.traverse(function(r){r.name===i&&(l[e]={object:r,transforms:function(e){for(var t=[],i=q.querySelector('[id="'+e.id+'"]'),r=0;r<i.childNodes.length;r++){var o=i.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"matrix":var a=n(o.textContent),s=new THREE.Matrix4().fromArray(a).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:s});break;case"translate":case"scale":var a=n(o.textContent),l=new THREE.Vector3().fromArray(a);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l});break;case"rotate":var a=n(o.textContent),l=new THREE.Vector3().fromArray(a),c=THREE.MathUtils.degToRad(a[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l,angle:c})}}return t}(t),joint:o,position:o.zeroPosition})})})(u.jointIndex,f)}}var m=new THREE.Matrix4;$={joints:r&&r.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var i=l[e];if(i){var n=i.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var r=i.object,o=n.axis,a=i.transforms;_.identity();for(var s=0;s<a.length;s++){var c=a[s];if(c.sid&&-1!==c.sid.indexOf(e))switch(n.type){case"revolute":_.multiply(m.makeRotationAxis(o,THREE.MathUtils.degToRad(t)));break;case"prismatic":_.multiply(m.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":_.multiply(c.obj);break;case"translate":_.multiply(m.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":_.scale(c.obj);break;case"rotate":_.multiply(m.makeRotationAxis(c.obj,c.angle))}}r.matrix.copy(_),r.matrix.decompose(r.position,r.quaternion,r.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}}();var et=(m=i(q,"scene")[0],W(o(i(m,"instance_visual_scene")[0].getAttribute("url"))));return"Z_UP"===J.upAxis&&et.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),et.scale.multiplyScalar(J.unit),{animations:Y,kinematics:$,library:ee,scene:et}}}},2217:function(e){e.exports=Object.assign(function(){},{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16})},2475:function(e){e.exports=function(e,t,i){this.type=e,this.index=t,this.pressed=i.pressed,this.value=i.value}},8958:function(e){function t(e){let t=document.getElementById(e),i=t.parentNode;try{i&&i.removeChild(t)}catch(e){}}e.exports=function(e){return e=e||{},function(i,n){var r;return r=n=n||{},new(e.Promise||Promise)(function(e,n){var o;let a=r.timeout||5e3,s="script_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),l=((o=document.createElement("script")).type="text/javascript",o.async=!0,o.id=s,o.src=i,o),c=setTimeout(function(){n(Error("Script request to "+i+" timed out")),t(s)},a),h=function(e){clearTimeout(e)};l.addEventListener("load",function(i){e({ok:!0}),h(c),t(s)}),l.addEventListener("error",function(e){n(Error("Script request to "+i+" failed "+e)),h(c),t(s)}),function(e){let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(l)})}}},399:function(){!function(e){var t,i,n="KeyboardEvent"in e;n||(e.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var r=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,o=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,a=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,s=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function l(e,t){return -1!==String(e).indexOf(t)}var c=l(navigator.platform,"Win")?"win":l(navigator.platform,"Mac")?"mac":l(navigator.platform,"CrOS")?"cros":l(navigator.platform,"Linux")?"linux":l(navigator.userAgent,"iPad")||l(navigator.platform,"iPod")||l(navigator.platform,"iPhone")?"ios":"",h=l(navigator.userAgent,"Chrome/")?"chrome":l(navigator.vendor,"Apple")?"safari":l(navigator.userAgent,"MSIE")?"ie":l(navigator.userAgent,"Gecko/")?"moz":l(navigator.userAgent,"Opera/")?"opera":"",d=h+"-"+c;function u(e,t,i){(d===t||h===t||c===t)&&Object.keys(i).forEach(function(t){e[t]=i[t]})}var p={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:o},92:{code:"OSRight",location:a},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:s},97:{code:"Numpad1",keyCap:"1",location:s},98:{code:"Numpad2",keyCap:"2",location:s},99:{code:"Numpad3",keyCap:"3",location:s},100:{code:"Numpad4",keyCap:"4",location:s},101:{code:"Numpad5",keyCap:"5",location:s},102:{code:"Numpad6",keyCap:"6",location:s},103:{code:"Numpad7",keyCap:"7",location:s},104:{code:"Numpad8",keyCap:"8",location:s},105:{code:"Numpad9",keyCap:"9",location:s},106:{code:"NumpadMultiply",keyCap:"*",location:s},107:{code:"NumpadAdd",keyCap:"+",location:s},108:{code:"NumpadComma",keyCap:",",location:s},109:{code:"NumpadSubtract",keyCap:"-",location:s},110:{code:"NumpadDecimal",keyCap:".",location:s},111:{code:"NumpadDivide",keyCap:"/",location:s},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:s},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:o},161:{code:"ShiftRight",location:a},162:{code:"ControlLeft",location:o},163:{code:"ControlRight",location:a},164:{code:"AltLeft",location:o},165:{code:"AltRight",location:a},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};u(p,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:s},189:{code:"NumpadSubtract",keyCap:"-",location:s}}),u(p,"moz-mac",{12:{code:"NumLock",location:s},173:{code:"Minus",keyCap:"-"}}),u(p,"moz-win",{173:{code:"Minus",keyCap:"-"}}),u(p,"chrome-mac",{93:{code:"OSRight",location:a}}),u(p,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),u(p,"ios",{10:{code:"Enter",location:r}}),u(p,"safari-mac",{91:{code:"OSLeft",location:o},93:{code:"OSRight",location:a},229:{code:"KeyQ",keyCap:"Q"}});var f={};"cros"===c&&(f["U+00A0"]={code:"ShiftLeft",location:o},f["U+00A1"]={code:"ShiftRight",location:a},f["U+00A2"]={code:"ControlLeft",location:o},f["U+00A3"]={code:"ControlRight",location:a},f["U+00A4"]={code:"AltLeft",location:o},f["U+00A5"]={code:"AltRight",location:a}),"chrome-mac"===d&&(f["U+0010"]={code:"ContextMenu"}),"safari-mac"===d&&(f["U+0010"]={code:"ContextMenu"}),"ios"===c&&(f["U+0010"]={code:"Function"},f["U+001C"]={code:"ArrowLeft"},f["U+001D"]={code:"ArrowRight"},f["U+001E"]={code:"ArrowUp"},f["U+001F"]={code:"ArrowDown"},f["U+0001"]={code:"Home"},f["U+0004"]={code:"End"},f["U+000B"]={code:"PageUp"},f["U+000C"]={code:"PageDown"});var m=[];m[o]={16:{code:"ShiftLeft",location:o},17:{code:"ControlLeft",location:o},18:{code:"AltLeft",location:o}},m[a]={16:{code:"ShiftRight",location:a},17:{code:"ControlRight",location:a},18:{code:"AltRight",location:a}},m[s]={13:{code:"NumpadEnter",location:s}},u(m[s],"moz",{109:{code:"NumpadSubtract",location:s},107:{code:"NumpadAdd",location:s}}),u(m[o],"moz-mac",{224:{code:"OSLeft",location:o}}),u(m[a],"moz-mac",{224:{code:"OSRight",location:a}}),u(m[a],"moz-win",{91:{code:"OSRight",location:a}}),u(m[a],"mac",{93:{code:"OSRight",location:a}}),u(m[s],"chrome-mac",{12:{code:"NumLock",location:s}}),u(m[s],"safari-mac",{12:{code:"NumLock",location:s},187:{code:"NumpadAdd",location:s},189:{code:"NumpadSubtract",location:s},190:{code:"NumpadDecimal",location:s},191:{code:"NumpadDivide",location:s}});var v={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};u(v,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var y={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},g=(t="code",i={},Object.keys(p).forEach(function(e){var n=p[e];t in n&&(i[n[t]]=n)}),i);try{var b=n&&"location"in new KeyboardEvent("")}catch(e){}function w(e){var t,i="keyCode"in e?e.keyCode:"which"in e?e.which:0,n=function(){if(b||"keyLocation"in e){var t=b?e.location:e.keyLocation;if(t&&i in m[t])return m[t][i]}return"keyIdentifier"in e&&e.keyIdentifier in f?f[e.keyIdentifier]:i in p?p[i]:null}();if(!n)return null;var r=(t=v[n.code])?e.shiftKey&&"shiftKey"in t?t.shiftKey:t.key:n.code;return{code:n.code,key:r,location:n.location,keyCap:n.keyCap}}"KeyboardEvent"in e&&"defineProperty"in Object&&function(){function e(e,t,i){t in e||Object.defineProperty(e,t,i)}if(e(KeyboardEvent.prototype,"code",{get:function(){var e=w(this);return e?e.code:""}}),"key"in KeyboardEvent.prototype){var t=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var e=t.get.call(this);return y.hasOwnProperty(e)?y[e]:e}})}e(KeyboardEvent.prototype,"key",{get:function(){var e=w(this);return e&&"key"in e?e.key:"Unidentified"}}),e(KeyboardEvent.prototype,"location",{get:function(){var e=w(this);return e&&"location"in e?e.location:r}}),e(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in e.KeyboardEvent||(e.KeyboardEvent.queryKeyCap=function(e,t){if(e=String(e),!g.hasOwnProperty(e))return"Undefined";if(t&&"en-us"!==String(t).toLowerCase())throw Error("Unsupported locale");var i=g[e];return i.keyCap||i.code||"Undefined"}),e.identifyKey=function(e){if(!("code"in e)){var t=w(e);e.code=t?t.code:"",e.key=t&&"key"in t?t.key:"Unidentified",e.location="location"in e?e.location:"keyLocation"in e?e.keyLocation:t&&"location"in t?t.location:r,e.locale=""}}}(window)},5097:function(e){e.exports=AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(e){let t=this.el;if(this.active&&this.checkpoint!==e){if(this.checkpoint&&t.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=e,this.sync(),.1>this.position.distanceTo(this.targetPosition)){this.checkpoint=null;return}t.emit("navigation-start",{checkpoint:e}),"teleport"===this.data.mode&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,t.emit("navigation-end",{checkpoint:e}),t.components["movement-controls"].updateNavLocation())}},isVelocityActive:function(){return!!(this.active&&this.checkpoint)},getVelocity:function(){if(!this.active)return;let e=this.data,t=this.offset,i=this.position,n=this.targetPosition,r=this.checkpoint;return(this.sync(),.1>i.distanceTo(n))?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:r}),t.set(0,0,0)):(t.setLength(e.animateSpeed),t)},sync:function(){let e=this.offset,t=this.position,i=this.targetPosition;t.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(i),i.add(this.checkpoint.components.checkpoint.getOffset()),e.copy(i).sub(t)}})},9789:function(e,t,i){let n=i(2217),r=i(2475),o={LEFT:"left",RIGHT:"right"},a={MOVEMENT:1,ROTATION:2};e.exports=AFRAME.registerComponent("gamepad-controls",{GamepadButton:n,schema:{enabled:{default:!0},rotationSensitivity:{default:2}},init:function(){let e=this.el.sceneEl;this.system=e.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};let t=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=t.x,this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=t.y,this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,e.addBehavior(this)},update:function(){this.tick()},tick:function(e,t){this.updateButtonState(),this.updateRotation(t)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;let e=this._dpadVector,t=this._moveVector;this.getDpad(e),this.getJoystick(a.MOVEMENT,t);let i=e.x||t.x,n=e.y||t.y;return Math.abs(i)>.2||Math.abs(n)>.2},getVelocityDelta:function(){let e=this._dpadVector,t=this._moveVector;this.getDpad(e),this.getJoystick(a.MOVEMENT,t);let i=e.x||t.x,n=e.y||t.y,r=new THREE.Vector3;return Math.abs(i)>.2&&(r.x+=i),Math.abs(n)>.2&&(r.z+=n),r},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;let e=this._lookVector;return this.getJoystick(a.ROTATION,e),Math.abs(e.x)>.2||Math.abs(e.y)>.2},updateRotation:function(e){if(!this.isRotationActive())return;let t=this.data,i=this.yaw,n=this.pitch;i.rotation.y=this.el.object3D.rotation.y,n.rotation.x=this.el.object3D.rotation.x;let r=this._lookVector;this.getJoystick(a.ROTATION,r),.2>=Math.abs(r.x)&&(r.x=0),.2>=Math.abs(r.y)&&(r.y=0),r.multiplyScalar(t.rotationSensitivity*e/1e3),i.rotation.y-=r.x,n.rotation.x-=r.y,n.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,n.rotation.x)),this.el.object3D.rotation.set(n.rotation.x,i.rotation.y,0)},updateButtonState:function(){let e=this.getGamepad(o.RIGHT);if(this.data.enabled&&e)for(var t=0;t<e.buttons.length;t++)e.buttons[t].pressed&&!this.buttons[t]?this.emit(new r("gamepadbuttondown",t,e.buttons[t])):!e.buttons[t].pressed&&this.buttons[t]&&this.emit(new r("gamepadbuttonup",t,e.buttons[t])),this.buttons[t]=e.buttons[t].pressed;else for(let e in this.buttons)this.buttons[e]=!1},emit:function(e){this.el.emit(e.type,e),this.el.emit(e.type+":"+e.index,new r(e.type,e.index,e))},getGamepad:function(){let e=[],t=[];return function(i){let n=this.el.sceneEl.components["proxy-controls"],r=n&&n.isConnected()&&n.getGamepad(0);if(r)return r;e.length=0;for(let t=0;t<this.system.controllers.length;t++){let n=this.system.controllers[t],r=n?n.gamepad:null;if(e.push(r),r&&n.handedness===i)return r}let o=navigator.getGamepads?navigator.getGamepads():t;for(let e=0;e<o.length;e++){let t=o[e];if(t&&t.hand===i)return t}return e[0]||o[0]}}(),getButton:function(e){return this.getGamepad(o.RIGHT).buttons[e]},getAxis:function(e){return this.getGamepad(e>1?o.RIGHT:o.LEFT).axes[e]},getJoystick:function(e,t){let i=this.getGamepad(e===a.MOVEMENT?o.LEFT:o.RIGHT);if(!i)return t.set(0,0);if("xr-standard"===i.mapping)switch(e){case a.MOVEMENT:return t.set(i.axes[2],i.axes[3]);case a.ROTATION:return t.set(i.axes[2],0)}else switch(e){case a.MOVEMENT:return t.set(i.axes[0],i.axes[1]);case a.ROTATION:return t.set(i.axes[2],i.axes[3])}throw Error('Unexpected joystick index "%d".',e)},getDpad:function(e){let t=this.getGamepad(o.LEFT);return t&&t.buttons[n.DPAD_RIGHT]?e.set((t.buttons[n.DPAD_RIGHT].pressed?1:0)+(t.buttons[n.DPAD_LEFT].pressed?-1:0),(t.buttons[n.DPAD_UP].pressed?-1:0)+(t.buttons[n.DPAD_DOWN].pressed?1:0)):e.set(0,0)},isConnected:function(){let e=this.getGamepad(o.LEFT);return!!(e&&e.connected)},getID:function(){return this.getGamepad(o.LEFT).id}})},2201:function(e,t,i){i(5097),i(9789),i(6602),i(1310),i(6307),i(356),i(133)},6602:function(e,t,i){i(399);let n=window.KeyboardEvent;e.exports=AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this),onContextMenu:this.onContextMenu.bind(this)}},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){let e=this.data,t=this.getKeys();return this.dVelocity.set(0,0,0),e.enabled&&((t.KeyW||t.ArrowUp)&&(this.dVelocity.z-=1),(t.KeyA||t.ArrowLeft)&&(this.dVelocity.x-=1),(t.KeyS||t.ArrowDown)&&(this.dVelocity.z+=1),(t.KeyD||t.ArrowRight)&&(this.dVelocity.x+=1),t.ShiftLeft&&(this.dVelocity=this.dVelocity.multiplyScalar(2))),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},attachEventListeners:function(){window.addEventListener("contextmenu",this.listeners.onContextMenu,!1),window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},onContextMenu:function(){for(let e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(this.localKeys[e.code]=!0,this.emit(e))},onKeyUp:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(delete this.localKeys[e.code],this.emit(e))},onBlur:function(){for(let e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},emit:function(e){"__keyboard-controls-proxy"in e&&this.el.emit(e.type,e),this.el.emit(e.type+":"+e.code,new n(e.type,e)),this.data.debug&&console.log(e.type+":"+e.code)},isPressed:function(e){return e in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){let e=this.el.sceneEl.components["proxy-controls"];return e&&e.isConnected()}})},6307:function(e){let t="-controls";e.exports=AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){let e=this.el;this.data.camera||(this.data.camera=e.querySelector("[camera]")),this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.eventDetail={},this.navGroup=null,this.navNode=null,e.sceneEl.hasLoaded?this.injectControls():e.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(e){let i=this.el,n=this.data,r=i.sceneEl.systems.nav;if(i.sceneEl.hasLoaded&&this.injectControls(),r&&n.constrainToNavMesh!==e.constrainToNavMesh&&(n.constrainToNavMesh?r.addAgent(this):r.removeAgent(this)),n.enabled!==e.enabled)for(let e=0;e<n.controls.length;e++){let i=n.controls[e]+t;this.el.setAttribute(i,{enabled:this.data.enabled})}},injectControls:function(){let e=this.data;for(let i=0;i<e.controls.length;i++){let n=e.controls[i]+t;this.el.setAttribute(n,{enabled:this.data.enabled})}},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:function(){let e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(n,r){if(!r)return;let o=this.el,a=this.data;if(!a.enabled)return;this.updateVelocityCtrl();let s=this.velocityCtrl,l=this.velocity;if(s){if(r/1e3>.2?l.set(0,0,0):this.updateVelocity(r),a.constrainToNavMesh&&!1!==s.isNavMeshConstrained){if(1e-5>l.lengthSq())return;e.copy(o.object3D.position),t.copy(l).multiplyScalar(r/1e3).add(e);let n=o.sceneEl.systems.nav;this.navGroup=null===this.navGroup?n.getGroup(e):this.navGroup,this.navNode=this.navNode||n.getNode(e,this.navGroup),this.navNode=n.clampStep(e,t,this.navGroup,this.navNode,i),o.object3D.position.copy(i)}else o.hasAttribute("velocity")?o.setAttribute("velocity",l):(o.object3D.position.x+=l.x*r/1e3,o.object3D.position.y+=l.y*r/1e3,o.object3D.position.z+=l.z*r/1e3)}}}(),updateVelocityCtrl:function(){let e=this.data;if(e.enabled){for(let i=0,n=e.controls.length;i<n;i++){let n=this.el.components[e.controls[i]+t];if(n&&n.isVelocityActive()){this.velocityCtrl=n;return}}this.velocityCtrl=null}},updateVelocity:function(){let e=new THREE.Vector2,t=new THREE.Quaternion;return function(i){let n;let r=this.el,o=this.velocityCtrl,a=this.velocity,s=this.data;if(o){if(o.getVelocityDelta)n=o.getVelocityDelta(i);else if(o.getVelocity){a.copy(o.getVelocity());return}else if(o.getPositionDelta){a.copy(o.getPositionDelta(i).multiplyScalar(1e3/i));return}else throw Error("Incompatible movement controls: ",o)}if(r.hasAttribute("velocity")&&!s.constrainToNavMesh&&a.copy(this.el.getAttribute("velocity")),n&&s.enabled){let i=s.camera;t.copy(i.object3D.quaternion),t.premultiply(r.object3D.quaternion),n.applyQuaternion(t);let o=n.length();s.fly?(a.copy(n),a.multiplyScalar(16.66667*this.data.speed)):(e.set(n.x,n.z),e.setLength(o*this.data.speed*16.66667),a.x=e.x,a.y=0,a.z=e.y),(0!==a.x||0!==a.y||0!==a.z)&&(this.eventDetail.velocity=a,this.el.emit("moved",this.eventDetail))}}}()})},133:function(e,t,i){"use strict";i.r(t);var n=i(8272),r=i.n(n);AFRAME.registerComponent("nipple-controls",{schema:{enabled:{default:!0},mode:{default:"dynamic",oneOf:["static","semi","dynamic"]},rotationSensitivity:{default:1},moveJoystickEnabled:{default:!0},lookJoystickEnabled:{default:!0},sideMargin:{default:"30px"},bottomMargin:{default:"70px"},moveJoystickPosition:{default:"left",oneOf:["left","right"]},lookJoystickPosition:{default:"right",oneOf:["left","right"]}},init(){this.dVelocity=new THREE.Vector3,this.lookVector=new THREE.Vector2;let e=this.el.querySelector("[look-controls]").components["look-controls"];this.pitchObject=e.pitchObject,this.yawObject=e.yawObject,this.rigRotation=this.el.object3D.rotation,this.moveData=void 0,this.lookData=void 0,this.moving=!1,this.rotating=!1},update(e){(this.data.moveJoystickPosition!==e.moveJoystickPosition||this.data.sideMargin!==e.sideMargin||this.data.bottomMargin!==e.bottomMargin||this.data.mode!==e.mode)&&this.removeMoveJoystick(),(this.data.lookJoystickPosition!==e.lookJoystickPosition||this.data.sideMargin!==e.sideMargin||this.data.bottomMargin!==e.bottomMargin||this.data.mode!==e.mode)&&this.removeLookJoystick(),this.data.enabled&&this.data.moveJoystickEnabled?this.createMoveJoystick():this.removeMoveJoystick(),this.data.enabled&&this.data.lookJoystickEnabled?this.createLookJoystick():this.removeLookJoystick()},pause(){this.moving=!1,this.rotating=!1},remove(){this.removeMoveJoystick(),this.removeLookJoystick()},isVelocityActive(){return this.data.enabled&&this.moving},getVelocityDelta(){if(this.dVelocity.set(0,0,0),this.isVelocityActive()){let e=this.moveData.force<1?this.moveData.force:1,t=this.moveData.angle.radian,i=Math.cos(t)*e,n=-Math.sin(t)*e;this.dVelocity.set(i,0,n)}return this.dVelocity},isRotationActive(){return this.data.enabled&&this.rotating},updateRotation(e){if(!this.isRotationActive())return;let t=this.lookData.force<1?this.lookData.force:1,i=this.lookData.angle.radian,n=this.lookVector;n.x=Math.cos(i)*t,n.y=Math.sin(i)*t,n.multiplyScalar(this.data.rotationSensitivity*e/1e3),this.yawObject.rotation.y-=n.x;let r=this.pitchObject.rotation.x+n.y;r=Math.max(-Math.PI/2,Math.min(Math.PI/2,r)),this.pitchObject.rotation.x=r},tick:function(e,t){this.updateRotation(t)},initLeftZone(){let e=document.createElement("div");e.setAttribute("id","joystickLeftZone"),e.setAttribute("style",`position:absolute;${this.data.moveJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(e),this.leftZone=e},initRightZone(){let e=document.createElement("div");e.setAttribute("id","joystickRightZone"),e.setAttribute("style",`position:absolute;${this.data.lookJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(e),this.rightZone=e},createMoveJoystick(){if(this.moveJoystick)return;this.initLeftZone();let e={mode:this.data.mode,zone:this.leftZone,color:"white",fadeTime:0};this.leftZone.style.width="100px","static"===this.data.mode?(this.leftZone.style.height="100px",e.position={left:"50%",bottom:"50%"}):this.leftZone.style.height="400px",this.moveJoystick=r().create(e),this.moveJoystick.on("move",(e,t)=>{this.moveData=t,this.moving=!0}),this.moveJoystick.on("end",(e,t)=>{this.moving=!1})},createLookJoystick(){if(this.lookJoystick)return;this.initRightZone();let e={mode:this.data.mode,zone:this.rightZone,color:"white",fadeTime:0};this.rightZone.style.width="100px","static"===this.data.mode?(this.rightZone.style.height="100px",e.position={left:"50%",bottom:"50%"}):this.rightZone.style.height="400px",this.lookJoystick=r().create(e),this.lookJoystick.on("move",(e,t)=>{this.lookData=t,this.rotating=!0}),this.lookJoystick.on("end",(e,t)=>{this.rotating=!1})},removeMoveJoystick(){this.moveJoystick&&(this.moveJoystick.destroy(),this.moveJoystick=void 0),this.moveData=void 0,this.leftZone&&this.leftZone.parentNode&&(this.leftZone.remove(),this.leftZone=void 0)},removeLookJoystick(){this.lookJoystick&&(this.lookJoystick.destroy(),this.lookJoystick=void 0),this.lookData=void 0,this.rightZone&&this.rightZone.parentNode&&(this.rightZone.remove(),this.rightZone=void 0)}})},1310:function(e){e.exports=AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){let e=this.el.sceneEl,t=e.canvas;if(!t){e.addEventListener("render-target-loaded",this.addEventListeners.bind(this));return}t.addEventListener("touchstart",this.onTouchStart,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd,{passive:!0});let i=e.getAttribute("vr-mode-ui");i&&i.cardboardModeEnabled&&e.addEventListener("enter-vr",this.onEnterVR)},removeEventListeners:function(){let e=this.el.sceneEl&&this.el.sceneEl.canvas;e&&(e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchend",this.onTouchEnd),this.el.sceneEl.removeEventListener("enter-vr",this.onEnterVR))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},onTouchStart:function(e){this.direction=-1,this.data.reverseEnabled&&e.touches&&2===e.touches.length&&(this.direction=1),e.preventDefault()},onTouchEnd:function(e){this.direction=0,e.preventDefault()},onEnterVR:function(){let e=this.el.sceneEl.xrSession;e&&(e.addEventListener("selectstart",this.onTouchStart),e.addEventListener("selectend",this.onTouchEnd))}})},356:function(e){e.exports=AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){let e=this.data,t=this.el.sceneEl;switch(t.addEventListener("axismove",this.onAxisMove),e.mode){case"swipe":case"touch":t.addEventListener("trackpadtouchstart",this.onTouchStart),t.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":t.addEventListener("trackpaddown",this.onTouchStart),t.addEventListener("trackpadup",this.onTouchEnd)}},removeEventListeners:function(){let e=this.el.sceneEl;e.removeEventListener("axismove",this.onAxisMove),e.removeEventListener("trackpadtouchstart",this.onTouchStart),e.removeEventListener("trackpadtouchend",this.onTouchEnd),e.removeEventListener("trackpaddown",this.onTouchStart),e.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(e){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":case"press":this.isMoving=!0}e.preventDefault()},onTouchEnd:function(e){"swipe"==this.data.mode&&(this.startingAxisData=[]),this.isMoving=!1,e.preventDefault()},onAxisMove:function(e){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(e);case"touch":case"press":return this.handleTouchAxis(e)}},handleSwipeAxis:function(e){let t=this.data,i=e.detail.axis;if(0===this.startingAxisData.length&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=i[0],this.startingAxisData[1]=i[1]),this.startingAxisData.length>0){let e=0,n=0;t.enableNegX&&i[0]<this.startingAxisData[0]&&(e=-1),t.enablePosX&&i[0]>this.startingAxisData[0]&&(e=1),t.enablePosZ&&i[1]>this.startingAxisData[1]&&(n=-1),t.enableNegZ&&i[1]<this.startingAxisData[1]&&(n=1);let r=Math.abs(this.startingAxisData[1]-i[1]);Math.abs(this.startingAxisData[0]-i[0])>r?(this.zVel=0,this.xVel=e):(this.xVel=0,this.zVel=n),this.isMoving=!0}},handleTouchAxis:function(e){let t=this.data,i=e.detail.axis,n=0,r=0;t.enableNegX&&i[0]<0&&(n=-1),t.enablePosX&&i[0]>0&&(n=1),t.enablePosZ&&i[1]>0&&(r=-1),t.enableNegZ&&i[1]<0&&(r=1),Math.abs(i[0])>Math.abs(i[1])?(this.zVel=0,this.xVel=n):(this.xVel=0,this.zVel=r)}})},1985:function(e){let t={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};function i(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}e.exports=AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},useRegExp:{default:!1},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(t)},repetitions:{default:1/0,min:0},timeScale:{default:1},startAt:{default:0}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];let e=this.el.getObject3D("mesh");e?this.load(e):this.el.addEventListener("model-loaded",e=>{this.load(e.detail.model)})},load:function(e){let t=this.el;this.model=e,this.mixer=new THREE.AnimationMixer(e),this.mixer.addEventListener("loop",e=>{t.emit("animation-loop",{action:e.action,loopDelta:e.loopDelta})}),this.mixer.addEventListener("finished",e=>{t.emit("animation-finished",{action:e.action,direction:e.direction})}),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(e){if(!e)return;let i=this.data,n=AFRAME.utils.diff(i,e);if("clip"in n){this.stopAction(),i.clip&&this.playAction();return}this.activeActions.forEach(e=>{"duration"in n&&i.duration&&e.setDuration(i.duration),"clampWhenFinished"in n&&(e.clampWhenFinished=i.clampWhenFinished),("loop"in n||"repetitions"in n)&&e.setLoop(t[i.loop],i.repetitions),"timeScale"in n&&e.setEffectiveTimeScale(i.timeScale)})},stopAction:function(){let e=this.data;for(let t=0;t<this.activeActions.length;t++)e.crossFadeDuration?this.activeActions[t].fadeOut(e.crossFadeDuration):this.activeActions[t].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;let e=this.model,n=this.data,r=e.animations||(e.geometry||{}).animations||[];if(!r.length)return;let o=n.useRegExp?n.clip:RegExp("^"+n.clip.split(/\*+/).map(i).join(".*")+"$");for(let i,a=0;i=r[a];a++)if(i.name.match(o)){let r=this.mixer.clipAction(i,e);r.enabled=!0,r.clampWhenFinished=n.clampWhenFinished,n.duration&&r.setDuration(n.duration),1!==n.timeScale&&r.setEffectiveTimeScale(n.timeScale),r.startAt(this.mixer.time-n.startAt/1e3),r.setLoop(t[n.loop],n.repetitions).fadeIn(n.crossFadeDuration).play(),this.activeActions.push(r)}},tick:function(e,t){this.mixer&&!isNaN(t)&&this.mixer.update(t/1e3)}})},681:function(e,t,i){THREE.ColladaLoader=i(7813),e.exports.Component=AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var e=this,t=this.el,i=this.data,n=this.el.sceneEl.systems.renderer;i&&(this.remove(),this.loader.load(i,function(i){e.model=i.scene,e.model.traverse(function(e){if(e.isMesh){var t=e.material;t.color&&n.applyColorCorrection(t.color),t.map&&n.applyColorCorrection(t.map),t.emissive&&n.applyColorCorrection(t.emissive),t.emissiveMap&&n.applyColorCorrection(t.emissiveMap)}}),t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"collada",model:e.model})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},5766:function(e,t,i){"use strict";let n,r,o;i.r(t);var a=i(2515),s={},l=Uint8Array,c=Uint16Array,h=Int32Array,d=new l([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),u=new l([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),p=new l([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=function(e,t){for(var i=new c(31),n=0;n<31;++n)i[n]=t+=1<<e[n-1];for(var r=new h(i[30]),n=1;n<30;++n)for(var o=i[n];o<i[n+1];++o)r[o]=o-i[n]<<5|n;return{b:i,r:r}},m=f(d,2),v=m.b,y=m.r;v[28]=258,y[258]=28;for(var g=f(u,0),b=g.b,w=g.r,E=new c(32768),k=0;k<32768;++k){var x=(43690&k)>>1|(21845&k)<<1;x=(61680&(x=(52428&x)>>2|(13107&x)<<2))>>4|(3855&x)<<4,E[k]=((65280&x)>>8|(255&x)<<8)>>1}for(var T=function(e,t,i){for(var n,r=e.length,o=0,a=new c(t);o<r;++o)e[o]&&++a[e[o]-1];var s=new c(t);for(o=1;o<t;++o)s[o]=s[o-1]+a[o-1]<<1;if(i){n=new c(1<<t);var l=15-t;for(o=0;o<r;++o)if(e[o])for(var h=o<<4|e[o],d=t-e[o],u=s[e[o]-1]++<<d,p=u|(1<<d)-1;u<=p;++u)n[E[u]>>l]=h}else for(o=0,n=new c(r);o<r;++o)e[o]&&(n[o]=E[s[e[o]-1]++]>>15-e[o]);return n},A=new l(288),k=0;k<144;++k)A[k]=8;for(var k=144;k<256;++k)A[k]=9;for(var k=256;k<280;++k)A[k]=7;for(var k=280;k<288;++k)A[k]=8;for(var M=new l(32),k=0;k<32;++k)M[k]=5;var N=T(A,9,1),C=T(M,5,1),R=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},O=function(e,t,i){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&i},D=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},S=function(e){return(e+7)/8|0},I=function(e,t,i){return(null==t||t<0)&&(t=0),(null==i||i>e.length)&&(i=e.length),new l(e.subarray(t,i))},L=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],P=function(e,t,i){var n=Error(t||L[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,P),!i)throw n;return n},_=function(e,t,i,n){var r=e.length,o=n?n.length:0;if(!r||t.f&&!t.l)return i||new l(0);var a=!i,s=a||2!=t.i,c=t.i;a&&(i=new l(3*r));var h=function(e){var t=i.length;if(e>t){var n=new l(Math.max(2*t,e));n.set(i),i=n}},f=t.f||0,m=t.p||0,y=t.b||0,g=t.l,w=t.d,E=t.m,k=t.n,x=8*r;do{if(!g){f=O(e,m,1);var A=O(e,m+1,3);if(m+=3,A){if(1==A)g=N,w=C,E=9,k=5;else if(2==A){var M=O(e,m,31)+257,L=O(e,m+10,15)+4,_=M+O(e,m+5,31)+1;m+=14;for(var F=new l(_),H=new l(19),U=0;U<L;++U)H[p[U]]=O(e,m+3*U,7);m+=3*L;for(var V=R(H),z=(1<<V)-1,j=T(H,V,1),U=0;U<_;){var K=j[O(e,m,z)];m+=15&K;var B=K>>4;if(B<16)F[U++]=B;else{var G=0,X=0;for(16==B?(X=3+O(e,m,3),m+=2,G=F[U-1]):17==B?(X=3+O(e,m,7),m+=3):18==B&&(X=11+O(e,m,127),m+=7);X--;)F[U++]=G}}var W=F.subarray(0,M),q=F.subarray(M);E=R(W),k=R(q),g=T(W,E,1),w=T(q,k,1)}else P(1)}else{var B=S(m)+4,J=e[B-4]|e[B-3]<<8,Z=B+J;if(Z>r){c&&P(0);break}s&&h(y+J),i.set(e.subarray(B,Z),y),t.b=y+=J,t.p=m=8*Z,t.f=f;continue}if(m>x){c&&P(0);break}}s&&h(y+131072);for(var Y=(1<<E)-1,$=(1<<k)-1,Q=m;;Q=m){var G=g[D(e,m)&Y],ee=G>>4;if((m+=15&G)>x){c&&P(0);break}if(G||P(2),ee<256)i[y++]=ee;else if(256==ee){Q=m,g=null;break}else{var et=ee-254;if(ee>264){var U=ee-257,ei=d[U];et=O(e,m,(1<<ei)-1)+v[U],m+=ei}var en=w[D(e,m)&$],er=en>>4;en||P(3),m+=15&en;var q=b[er];if(er>3){var ei=u[er];q+=D(e,m)&(1<<ei)-1,m+=ei}if(m>x){c&&P(0);break}s&&h(y+131072);var eo=y+et;if(y<q){var ea=o-q,es=Math.min(q,eo);for(ea+y<0&&P(3);y<es;++y)i[y]=n[ea+y]}for(;y<eo;++y)i[y]=i[y-q]}}t.l=g,t.p=Q,t.b=y,t.f=f,g&&(f=1,t.m=E,t.d=w,t.n=k)}while(!f);return y!=i.length&&a?I(i,0,y):i.subarray(0,y)},F=function(e,t,i){i<<=7&t;var n=t/8|0;e[n]|=i,e[n+1]|=i>>8},H=function(e,t,i){i<<=7&t;var n=t/8|0;e[n]|=i,e[n+1]|=i>>8,e[n+2]|=i>>16},U=function(e,t){for(var i=[],n=0;n<e.length;++n)e[n]&&i.push({s:n,f:e[n]});var r=i.length,o=i.slice();if(!r)return{t:X,l:0};if(1==r){var a=new l(i[0].s+1);return a[i[0].s]=1,{t:a,l:1}}i.sort(function(e,t){return e.f-t.f}),i.push({s:-1,f:25001});var s=i[0],h=i[1],d=0,u=1,p=2;for(i[0]={s:-1,f:s.f+h.f,l:s,r:h};u!=r-1;)s=i[i[d].f<i[p].f?d++:p++],h=i[d!=u&&i[d].f<i[p].f?d++:p++],i[u++]={s:-1,f:s.f+h.f,l:s,r:h};for(var f=o[0].s,n=1;n<r;++n)o[n].s>f&&(f=o[n].s);var m=new c(f+1),v=V(i[u-1],m,0);if(v>t){var n=0,y=0,g=v-t,b=1<<g;for(o.sort(function(e,t){return m[t.s]-m[e.s]||e.f-t.f});n<r;++n){var w=o[n].s;if(m[w]>t)y+=b-(1<<v-m[w]),m[w]=t;else break}for(y>>=g;y>0;){var E=o[n].s;m[E]<t?y-=1<<t-m[E]++-1:++n}for(;n>=0&&y;--n){var k=o[n].s;m[k]==t&&(--m[k],++y)}v=t}return{t:new l(m),l:v}},V=function(e,t,i){return -1==e.s?Math.max(V(e.l,t,i+1),V(e.r,t,i+1)):t[e.s]=i},z=function(e){for(var t=e.length;t&&!e[--t];);for(var i=new c(++t),n=0,r=e[0],o=1,a=function(e){i[n++]=e},s=1;s<=t;++s)if(e[s]==r&&s!=t)++o;else{if(!r&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(r),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(r);o=1,r=e[s]}return{c:i.subarray(0,n),n:t}},j=function(e,t){for(var i=0,n=0;n<t.length;++n)i+=e[n]*t[n];return i},K=function(e,t,i){var n=i.length,r=S(t+2);e[r]=255&n,e[r+1]=n>>8,e[r+2]=255^e[r],e[r+3]=255^e[r+1];for(var o=0;o<n;++o)e[r+o+4]=i[o];return(r+4+n)*8},B=function(e,t,i,n,r,o,a,s,l,h,f){F(t,f++,i),++r[256];for(var m,v,y,g,b=U(r,15),w=b.t,E=b.l,k=U(o,15),x=k.t,N=k.l,C=z(w),R=C.c,O=C.n,D=z(x),S=D.c,I=D.n,L=new c(19),P=0;P<R.length;++P)++L[31&R[P]];for(var P=0;P<S.length;++P)++L[31&S[P]];for(var _=U(L,7),V=_.t,B=_.l,G=19;G>4&&!V[p[G-1]];--G);var X=h+5<<3,W=j(r,A)+j(o,M)+a,q=j(r,w)+j(o,x)+a+14+3*G+j(L,V)+2*L[16]+3*L[17]+7*L[18];if(l>=0&&X<=W&&X<=q)return K(t,f,e.subarray(l,l+h));if(F(t,f,1+(q<W)),f+=2,q<W){m=T(w,E,0),v=w,y=T(x,N,0),g=x;var J=T(V,B,0);F(t,f,O-257),F(t,f+5,I-1),F(t,f+10,G-4),f+=14;for(var P=0;P<G;++P)F(t,f+3*P,V[p[P]]);f+=3*G;for(var Z=[R,S],Y=0;Y<2;++Y)for(var $=Z[Y],P=0;P<$.length;++P){var Q=31&$[P];F(t,f,J[Q]),f+=V[Q],Q>15&&(F(t,f,$[P]>>5&127),f+=$[P]>>12)}}else m=null,v=A,y=null,g=M;for(var P=0;P<s;++P){var ee=n[P];if(ee>255){var Q=ee>>18&31;H(t,f,m[Q+257]),f+=v[Q+257],Q>7&&(F(t,f,ee>>23&31),f+=d[Q]);var et=31&ee;H(t,f,y[et]),f+=g[et],et>3&&(H(t,f,ee>>5&8191),f+=u[et])}else H(t,f,m[ee]),f+=v[ee]}return H(t,f,m[256]),f+v[256]},G=new h([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),X=new l(0),W=function(e,t,i,n,r,o){var a=o.z||e.length,s=new l(n+a+5*(1+Math.ceil(a/7e3))+r),p=s.subarray(n,s.length-r),f=o.l,m=7&(o.r||0);if(t){m&&(p[0]=o.r>>3);for(var v=G[t-1],g=v>>13,b=8191&v,E=(1<<i)-1,k=o.p||new c(32768),x=o.h||new c(E+1),T=Math.ceil(i/3),A=2*T,M=function(t){return(e[t]^e[t+1]<<T^e[t+2]<<A)&E},N=new h(25e3),C=new c(288),R=new c(32),O=0,D=0,L=o.i||0,P=0,_=o.w||0,F=0;L+2<a;++L){var H=M(L),U=32767&L,V=x[H];if(k[U]=V,x[H]=U,_<=L){var z=a-L;if((O>7e3||P>24576)&&(z>423||!f)){m=B(e,p,0,N,C,R,D,P,F,L-F,m),P=O=D=0,F=L;for(var j=0;j<286;++j)C[j]=0;for(var j=0;j<30;++j)R[j]=0}var X=2,W=0,q=b,J=U-V&32767;if(z>2&&H==M(L-J))for(var Z=Math.min(g,z)-1,Y=Math.min(32767,L),$=Math.min(258,z);J<=Y&&--q&&U!=V;){if(e[L+X]==e[L+X-J]){for(var Q=0;Q<$&&e[L+Q]==e[L+Q-J];++Q);if(Q>X){if(X=Q,W=J,Q>Z)break;for(var ee=Math.min(J,Q-2),et=0,j=0;j<ee;++j){var ei=L-J+j&32767,en=k[ei],er=ei-en&32767;er>et&&(et=er,V=ei)}}}V=k[U=V],J+=U-V&32767}if(W){N[P++]=268435456|y[X]<<18|w[W];var eo=31&y[X],ea=31&w[W];D+=d[eo]+u[ea],++C[257+eo],++R[ea],_=L+X,++O}else N[P++]=e[L],++C[e[L]]}}for(L=Math.max(L,_);L<a;++L)N[P++]=e[L],++C[e[L]];m=B(e,p,f,N,C,R,D,P,F,L-F,m),f||(o.r=7&m|p[m/8|0]<<3,m-=7,o.h=x,o.p=k,o.i=L,o.w=_)}else{for(var L=o.w||0;L<a+f;L+=65535){var es=L+65535;es>=a&&(p[m/8|0]=f,es=a),m=K(p,m+1,e.subarray(L,es))}o.i=a}return I(s,0,n+S(m)+r)},q="undefined"!=typeof TextDecoder&&new TextDecoder;try{q.decode(X,{stream:!0})}catch(e){}function J(e,t,i){let n=i.length-e-1;if(t>=i[n])return n-1;if(t<=i[e])return e;let r=e,o=n,a=Math.floor((r+o)/2);for(;t<i[a]||t>=i[a+1];)t<i[a]?o=a:r=a,a=Math.floor((r+o)/2);return a}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;class Z extends a.Hyl{constructor(e,t,i,n,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=n||0,this.endKnot=r||this.knots.length-1;for(let e=0;e<i.length;++e){let t=i[e];this.controlPoints[e]=new a.Ltg(t.x,t.y,t.z,t.w)}}getPoint(e,t=new a.Pa4){let i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),n=function(e,t,i,n){let r=J(e,n,t),o=function(e,t,i,n){let r=[],o=[],a=[];r[0]=1;for(let s=1;s<=i;++s){o[s]=t-n[e+1-s],a[s]=n[e+s]-t;let i=0;for(let e=0;e<s;++e){let t=a[e+1],n=o[s-e],l=r[e]/(t+n);r[e]=i+t*l,i=n*l}r[s]=i}return r}(r,n,e,t),s=new a.Ltg(0,0,0,0);for(let t=0;t<=e;++t){let n=i[r-e+t],a=o[t],l=n.w*a;s.x+=n.x*l,s.y+=n.y*l,s.z+=n.z*l,s.w+=n.w*a}return s}(this.degree,this.knots,this.controlPoints,i);return 1!==n.w&&n.divideScalar(n.w),t.set(n.x,n.y,n.z)}getTangent(e,t=new a.Pa4){var i;let n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=(i=this.degree,function(e){let t=e.length,i=[],n=[];for(let r=0;r<t;++r){let t=e[r];i[r]=new a.Pa4(t.x,t.y,t.z),n[r]=t.w}let r=[];for(let e=0;e<t;++e){let t=i[e].clone();for(let i=1;i<=e;++i)t.sub(r[e-i].clone().multiplyScalar(function(e,t){let i=1;for(let t=2;t<=e;++t)i*=t;let n=1;for(let e=2;e<=t;++e)n*=e;for(let i=2;i<=e-t;++i)n*=i;return i/n}(e,i)*n[i]));r[e]=t.divideScalar(n[0])}return r}(function(e,t,i,n,r){let o=1<e?1:e,s=[],l=J(e,n,t),c=function(e,t,i,n,r){let o=[];for(let e=0;e<=i;++e)o[e]=0;let a=[];for(let e=0;e<=n;++e)a[e]=o.slice(0);let s=[];for(let e=0;e<=i;++e)s[e]=o.slice(0);s[0][0]=1;let l=o.slice(0),c=o.slice(0);for(let n=1;n<=i;++n){l[n]=t-r[e+1-n],c[n]=r[e+n]-t;let i=0;for(let e=0;e<n;++e){let t=c[e+1],r=l[n-e];s[n][e]=t+r;let o=s[e][n-1]/s[n][e];s[e][n]=i+t*o,i=r*o}s[n][n]=i}for(let e=0;e<=i;++e)a[0][e]=s[e][i];for(let e=0;e<=i;++e){let t=0,r=1,l=[];for(let e=0;e<=i;++e)l[e]=o.slice(0);l[0][0]=1;for(let o=1;o<=n;++o){let n=0,c=e-o,h=i-o;e>=o&&(l[r][0]=l[t][0]/s[h+1][c],n=l[r][0]*s[c][h]);let d=c>=-1?1:-c,u=e-1<=h?o-1:i-e;for(let e=d;e<=u;++e)l[r][e]=(l[t][e]-l[t][e-1])/s[h+1][c+e],n+=l[r][e]*s[c+e][h];e<=h&&(l[r][o]=-l[t][o-1]/s[h+1][e],n+=l[r][o]*s[e][h]),a[o][e]=n;let p=t;t=r,r=p}}let h=i;for(let e=1;e<=n;++e){for(let t=0;t<=i;++t)a[e][t]*=h;h*=i-e}return a}(l,n,e,o,t),h=[];for(let e=0;e<i.length;++e){let t=i[e].clone(),n=t.w;t.x*=n,t.y*=n,t.z*=n,h[e]=t}for(let t=0;t<=o;++t){let i=h[l-e].clone().multiplyScalar(c[t][0]);for(let n=1;n<=e;++n)i.add(h[l-e+n].clone().multiplyScalar(c[t][n]));s[t]=i}for(let e=o+1;e<=r+1;++e)s[e]=new a.Ltg(0,0,0);return s}(i,this.knots,this.controlPoints,n,1)));return t.copy(r[1]).normalize(),t}}class Y extends a.aNw{constructor(e){super(e)}load(e,t,i,n){let r=this,o=""===r.path?a.Zp0.extractUrlBase(e):r.path,s=new a.hH6(this.manager);s.setPath(r.path),s.setResponseType("arraybuffer"),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,function(i){try{t(r.parse(i,o))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}},i,n)}parse(e,t){if(function(e){let t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===ef(e,0,t.length)}(e))n=new ei().parse(e);else{let t=ef(e);if(!function(e){let t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0;for(let n=0;n<t.length;++n)if(function(t){let n=e[0];return e=e.slice(i+1),i++,n}(0)===t[n])return!1;return!0}(t))throw Error("THREE.FBXLoader: Unknown format.");if(7e3>eo(t))throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+eo(t));n=new et().parse(t)}return new $(new a.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),this.manager).parse(n)}}class ${constructor(e,t){this.textureLoader=e,this.manager=t}parse(){r=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),n=this.parseDeformers(),a=new Q().parse(n);return this.parseScene(n,a,i),o}parseConnections(){let e=new Map;return"Connections"in n&&n.Connections.connections.forEach(function(t){let i=t[0],n=t[1],r=t[2];e.has(i)||e.set(i,{parents:[],children:[]}),e.get(i).parents.push({ID:n,relationship:r}),e.has(n)||e.set(n,{parents:[],children:[]}),e.get(n).children.push({ID:i,relationship:r})}),e}parseImages(){let e={},t={};if("Video"in n.Objects){let i=n.Objects.Video;for(let n in i){let r=i[n];if(e[parseInt(n)]=r.RelativeFilename||r.Filename,"Content"in r){let e=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,o="string"==typeof r.Content&&""!==r.Content;if(e||o){let e=this.parseImage(i[n]);t[r.RelativeFilename||r.Filename]=e}}}}for(let i in e){let n=e[i];void 0!==t[n]?e[i]=t[n]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){let t;let i=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(r){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),t="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if("string"==typeof i)return"data:"+t+";base64,"+i;{let e=new Uint8Array(i);return window.URL.createObjectURL(new Blob([e],{type:t}))}}parseTextures(e){let t=new Map;if("Texture"in n.Objects){let i=n.Objects.Texture;for(let n in i){let r=this.parseTexture(i[n],e);t.set(parseInt(n),r)}}return t}parseTexture(e,t){let i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;let n=e.WrapModeU,r=e.WrapModeV,o=void 0!==n?n.value:0,s=void 0!==r?r.value:0;if(i.wrapS=0===o?a.rpg:a.uWy,i.wrapT=0===s?a.rpg:a.uWy,"Scaling"in e){let t=e.Scaling.value;i.repeat.x=t[0],i.repeat.y=t[1]}if("Translation"in e){let t=e.Translation.value;i.offset.x=t[0],i.offset.y=t[1]}return i}loadTexture(e,t){let i,n;let o=this.textureLoader.path,s=r.get(e.id).children;void 0!==s&&s.length>0&&void 0!==t[s[0].ID]&&(0===(i=t[s[0].ID]).indexOf("blob:")||0===i.indexOf("data:"))&&this.textureLoader.setPath(void 0);let l=e.FileName.slice(-3).toLowerCase();if("tga"===l){let t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),n=new a.xEZ):(t.setPath(this.textureLoader.path),n=t.load(i))}else if("dds"===l){let t=this.manager.getHandler(".dds");null===t?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),n=new a.xEZ):(t.setPath(this.textureLoader.path),n=t.load(i))}else"psd"===l?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),n=new a.xEZ):n=this.textureLoader.load(i);return this.textureLoader.setPath(o),n}parseMaterials(e){let t=new Map;if("Material"in n.Objects){let i=n.Objects.Material;for(let n in i){let r=this.parseMaterial(i[n],e);null!==r&&t.set(parseInt(n),r)}}return t}parseMaterial(e,t){let i;let n=e.id,o=e.attrName,s=e.ShadingModel;if("object"==typeof s&&(s=s.value),!r.has(n))return null;let l=this.parseParameters(e,t,n);switch(s.toLowerCase()){case"phong":i=new a.xoR;break;case"lambert":i=new a.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),i=new a.xoR}return i.setValues(l),i.name=o,i}parseParameters(e,t,i){let n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=new a.Ilk().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&("Color"===e.DiffuseColor.type||"ColorRGB"===e.DiffuseColor.type)&&(n.color=new a.Ilk().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=new a.Ilk().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&("Color"===e.EmissiveColor.type||"ColorRGB"===e.EmissiveColor.type)&&(n.emissive=new a.Ilk().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=new a.Ilk().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&"Color"===e.SpecularColor.type&&(n.specular=new a.Ilk().fromArray(e.SpecularColor.value).convertSRGBToLinear());let o=this;return r.get(i).children.forEach(function(e){let i=e.relationship;switch(i){case"Bump":n.bumpMap=o.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":n.aoMap=o.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=o.getTexture(t,e.ID),void 0!==n.map&&(n.map.colorSpace=a.KI_);break;case"DisplacementColor":n.displacementMap=o.getTexture(t,e.ID);break;case"EmissiveColor":n.emissiveMap=o.getTexture(t,e.ID),void 0!==n.emissiveMap&&(n.emissiveMap.colorSpace=a.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=o.getTexture(t,e.ID);break;case"ReflectionColor":n.envMap=o.getTexture(t,e.ID),void 0!==n.envMap&&(n.envMap.mapping=a.dSO,n.envMap.colorSpace=a.KI_);break;case"SpecularColor":n.specularMap=o.getTexture(t,e.ID),void 0!==n.specularMap&&(n.specularMap.colorSpace=a.KI_);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=o.getTexture(t,e.ID),n.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",i)}}),n}getTexture(e,t){return"LayeredTexture"in n.Objects&&t in n.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=r.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in n.Objects){let i=n.Objects.Deformer;for(let n in i){let o=i[n],a=r.get(parseInt(n));if("Skin"===o.attrType){let t=this.parseSkeleton(a,i);t.ID=n,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=a.parents[0].ID,e[n]=t}else if("BlendShape"===o.attrType){let e={id:n};e.rawTargets=this.parseMorphTargets(a,i),e.id=n,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){let i=[];return e.children.forEach(function(e){let n=t[e.ID];if("Cluster"!==n.attrType)return;let r={ID:e.ID,indices:[],weights:[],transformLink:new a.yGw().fromArray(n.TransformLink.a)};"Indexes"in n&&(r.indices=n.Indexes.a,r.weights=n.Weights.a),i.push(r)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){let i=[];for(let n=0;n<e.children.length;n++){let o=e.children[n],a=t[o.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;s.geoID=r.get(parseInt(o.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,i.push(s)}return i}parseScene(e,t,i){o=new a.ZAu;let s=this.parseModels(e.skeletons,t,i),l=n.Objects.Model,c=this;s.forEach(function(e){let t=l[e.ID];c.setLookAtProperties(e,t),r.get(e.ID).parents.forEach(function(t){let i=s.get(t.ID);void 0!==i&&i.add(e)}),null===e.parent&&o.add(e)}),this.bindSkeleton(e.skeletons,t,s),this.addGlobalSceneSettings(),o.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);let t=ed(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}});let h=new ee().parse();1===o.children.length&&o.children[0].isGroup&&(o.children[0].animations=h,o=o.children[0]),o.animations=h}parseModels(e,t,i){let o=new Map,s=n.Objects.Model;for(let n in s){let l=parseInt(n),c=s[n],h=r.get(l),d=this.buildSkeleton(h,e,l,c.attrName);if(!d){switch(c.attrType){case"Camera":d=this.createCamera(h);break;case"Light":d=this.createLight(h);break;case"Mesh":d=this.createMesh(h,t,i);break;case"NurbsCurve":d=this.createCurve(h,t);break;case"LimbNode":case"Root":d=new a.N$j;break;default:d=new a.ZAu}d.name=c.attrName?a.iUV.sanitizeNodeName(c.attrName):"",d.userData.originalName=c.attrName,d.ID=l}this.getTransformData(d,c),o.set(l,d)}return o}buildSkeleton(e,t,i,n){let r=null;return e.parents.forEach(function(e){for(let o in t){let s=t[o];s.rawBones.forEach(function(t,o){if(t.ID===e.ID){let e=r;(r=new a.N$j).matrixWorld.copy(t.transformLink),r.name=n?a.iUV.sanitizeNodeName(n):"",r.userData.originalName=n,r.ID=i,s.bones[o]=r,null!==e&&r.add(e)}})}}),r}createCamera(e){let t,i;if(e.children.forEach(function(e){let t=n.Objects.NodeAttribute[e.ID];void 0!==t&&(i=t)}),void 0===i)t=new a.Tme;else{let e=0;void 0!==i.CameraProjectionType&&1===i.CameraProjectionType.value&&(e=1);let n=1;void 0!==i.NearPlane&&(n=i.NearPlane.value/1e3);let r=1e3;void 0!==i.FarPlane&&(r=i.FarPlane.value/1e3);let o=window.innerWidth,s=window.innerHeight;void 0!==i.AspectWidth&&void 0!==i.AspectHeight&&(o=i.AspectWidth.value,s=i.AspectHeight.value);let l=o/s,c=45;void 0!==i.FieldOfView&&(c=i.FieldOfView.value);let h=i.FocalLength?i.FocalLength.value:null;switch(e){case 0:t=new a.cPb(c,l,n,r),null!==h&&t.setFocalLength(h);break;case 1:t=new a.iKG(-o/2,o/2,s/2,-s/2,n,r);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new a.Tme}}return t}createLight(e){let t,i;if(e.children.forEach(function(e){let t=n.Objects.NodeAttribute[e.ID];void 0!==t&&(i=t)}),void 0===i)t=new a.Tme;else{let e;e=void 0===i.LightType?0:i.LightType.value;let n=16777215;void 0!==i.Color&&(n=new a.Ilk().fromArray(i.Color.value).convertSRGBToLinear());let r=void 0===i.Intensity?1:i.Intensity.value/100;void 0!==i.CastLightOnObject&&0===i.CastLightOnObject.value&&(r=0);let o=0;switch(void 0!==i.FarAttenuationEnd&&(o=void 0!==i.EnableFarAttenuation&&0===i.EnableFarAttenuation.value?0:i.FarAttenuationEnd.value),e){case 0:t=new a.cek(n,r,o,1);break;case 1:t=new a.Ox3(n,r);break;case 2:let s=Math.PI/3;void 0!==i.InnerAngle&&(s=a.M8C.degToRad(i.InnerAngle.value));let l=0;void 0!==i.OuterAngle&&(l=Math.max(l=a.M8C.degToRad(i.OuterAngle.value),1)),t=new a.PMe(n,r,o,s,l,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new a.cek(n,r)}void 0!==i.CastShadows&&1===i.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,i){let n;let r=null,o=null,s=[];return e.children.forEach(function(e){t.has(e.ID)&&(r=t.get(e.ID)),i.has(e.ID)&&s.push(i.get(e.ID))}),s.length>1?o=s:s.length>0?o=s[0]:(o=new a.xoR({name:a.aNw.DEFAULT_MATERIAL_NAME,color:13421772}),s.push(o)),"color"in r.attributes&&s.forEach(function(e){e.vertexColors=!0}),r.FBX_Deformer?(n=new a.TUv(r,o)).normalizeSkinWeights():n=new a.Kj0(r,o),n}createCurve(e,t){let i=e.children.reduce(function(e,i){return t.has(i.ID)&&(e=t.get(i.ID)),e},null),n=new a.nls({name:a.aNw.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new a.x12(i,n)}getTransformData(e,t){let i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=eu(t.RotationOrder.value):i.eulerOrder="ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&r.get(e.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){let i=n.Objects.Model[t.ID];if("Lcl_Translation"in i){let t=i.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),o.add(e.target)):e.lookAt(new a.Pa4().fromArray(t))}}})}bindSkeleton(e,t,i){let n=this.parsePoseNodes();for(let o in e){let s=e[o];r.get(parseInt(s.ID)).parents.forEach(function(e){if(t.has(e.ID)){let t=e.ID;r.get(t).parents.forEach(function(e){i.has(e.ID)&&i.get(e.ID).bind(new a.OdW(s.bones),n[e.ID])})}})}}parsePoseNodes(){let e={};if("Pose"in n.Objects){let t=n.Objects.Pose;for(let i in t)if("BindPose"===t[i].attrType&&t[i].NbPoseNodes>0){let n=t[i].PoseNode;Array.isArray(n)?n.forEach(function(t){e[t.Node]=new a.yGw().fromArray(t.Matrix.a)}):e[n.Node]=new a.yGw().fromArray(n.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in n){if("AmbientColor"in n.GlobalSettings){let e=n.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],r=e[2];if(0!==t||0!==i||0!==r){let e=new a.Ilk(t,i,r).convertSRGBToLinear();o.add(new a.Mig(e,1))}}"UnitScaleFactor"in n.GlobalSettings&&(o.userData.unitScaleFactor=n.GlobalSettings.UnitScaleFactor.value)}}}class Q{constructor(){this.negativeMaterialIndices=!1}parse(e){let t=new Map;if("Geometry"in n.Objects){let i=n.Objects.Geometry;for(let n in i){let o=r.get(parseInt(n)),a=this.parseGeometry(o,i[n],e);t.set(parseInt(n),a)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){let r=i.skeletons,o=[],a=e.parents.map(function(e){return n.Objects.Model[e.ID]});if(0===a.length)return;let s=e.children.reduce(function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e},null);e.children.forEach(function(e){void 0!==i.morphTargets[e.ID]&&o.push(i.morphTargets[e.ID])});let l=a[0],c={};"RotationOrder"in l&&(c.eulerOrder=eu(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);let h=ed(c);return this.genGeometry(t,s,o,h)}genGeometry(e,t,i,n){let r=new a.u9r;e.attrName&&(r.name=e.attrName);let o=this.parseGeoNode(e,t),s=this.genBuffers(o),l=new a.a$l(s.vertex,3);if(l.applyMatrix4(n),r.setAttribute("position",l),s.colors.length>0&&r.setAttribute("color",new a.a$l(s.colors,3)),t&&(r.setAttribute("skinIndex",new a.qlB(s.weightsIndices,4)),r.setAttribute("skinWeight",new a.a$l(s.vertexWeights,4)),r.FBX_Deformer=t),s.normal.length>0){let e=new a.Vkp().getNormalMatrix(n),t=new a.a$l(s.normal,3);t.applyNormalMatrix(e),r.setAttribute("normal",t)}if(s.uvs.forEach(function(e,t){let i=0===t?"uv":`uv${t}`;r.setAttribute(i,new a.a$l(s.uvs[t],2))}),o.material&&"AllSame"!==o.material.mappingType){let e=s.materialIndex[0],t=0;if(s.materialIndex.forEach(function(i,n){i!==e&&(r.addGroup(t,n-t,e),e=i,t=n)}),r.groups.length>0){let t=r.groups[r.groups.length-1],i=t.start+t.count;i!==s.materialIndex.length&&r.addGroup(i,s.materialIndex.length-i,e)}0===r.groups.length&&r.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(r,e,i,n),r}parseGeoNode(e,t){let i={};if(i.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],i.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return i.weightTable={},null!==t&&(i.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(n,r){void 0===i.weightTable[n]&&(i.weightTable[n]=[]),i.weightTable[n].push({id:t,weight:e.weights[r]})})})),i}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},i=0,n=0,r=!1,o=[],a=[],s=[],l=[],c=[],h=[],d=this;return e.vertexIndices.forEach(function(u,p){let f;let m=!1;u<0&&(u^=-1,m=!0);let v=[],y=[];if(o.push(3*u,3*u+1,3*u+2),e.color){let t=el(p,i,u,e.color);s.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[u]&&e.weightTable[u].forEach(function(e){y.push(e.weight),v.push(e.id)}),y.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);let e=[0,0,0,0],t=[0,0,0,0];y.forEach(function(i,n){let r=i,o=v[n];t.forEach(function(t,i,n){if(r>t){n[i]=r,r=t;let a=e[i];e[i]=o,o=a}})}),v=e,y=t}for(;y.length<4;)y.push(0),v.push(0);for(let e=0;e<4;++e)c.push(y[e]),h.push(v[e])}if(e.normal){let t=el(p,i,u,e.normal);a.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=el(p,i,u,e.material)[0])<0&&(d.negativeMaterialIndices=!0,f=0),e.uv&&e.uv.forEach(function(e,t){let n=el(p,i,u,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])}),n++,m&&(d.genFace(t,e,o,f,a,s,l,c,h,n),i++,n=0,o=[],a=[],s=[],l=[],c=[],h=[])}),t}getNormalNewell(e){let t=new a.Pa4(0,0,0);for(let i=0;i<e.length;i++){let n=e[i],r=e[(i+1)%e.length];t.x+=(n.y-r.y)*(n.z+r.z),t.y+=(n.z-r.z)*(n.x+r.x),t.z+=(n.x-r.x)*(n.y+r.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){let t=this.getNormalNewell(e),i=(Math.abs(t.z)>.5?new a.Pa4(0,1,0):new a.Pa4(0,0,1)).cross(t).normalize(),n=t.clone().cross(i).normalize();return{normal:t,tangent:i,bitangent:n}}flattenVertex(e,t,i){return new a.FM8(e.dot(t),e.dot(i))}genFace(e,t,i,n,r,o,s,l,c,h){let d;if(h>3){let e=[];for(let n=0;n<i.length;n+=3)e.push(new a.Pa4(t.vertexPositions[i[n]],t.vertexPositions[i[n+1]],t.vertexPositions[i[n+2]]));let{tangent:n,bitangent:r}=this.getNormalTangentAndBitangent(e),o=[];for(let t of e)o.push(this.flattenVertex(t,n,r));d=a.iDF.triangulateShape(o,[])}else d=[[0,1,2]];for(let[a,h,u]of d)e.vertex.push(t.vertexPositions[i[3*a]]),e.vertex.push(t.vertexPositions[i[3*a+1]]),e.vertex.push(t.vertexPositions[i[3*a+2]]),e.vertex.push(t.vertexPositions[i[3*h]]),e.vertex.push(t.vertexPositions[i[3*h+1]]),e.vertex.push(t.vertexPositions[i[3*h+2]]),e.vertex.push(t.vertexPositions[i[3*u]]),e.vertex.push(t.vertexPositions[i[3*u+1]]),e.vertex.push(t.vertexPositions[i[3*u+2]]),t.skeleton&&(e.vertexWeights.push(l[4*a]),e.vertexWeights.push(l[4*a+1]),e.vertexWeights.push(l[4*a+2]),e.vertexWeights.push(l[4*a+3]),e.vertexWeights.push(l[4*h]),e.vertexWeights.push(l[4*h+1]),e.vertexWeights.push(l[4*h+2]),e.vertexWeights.push(l[4*h+3]),e.vertexWeights.push(l[4*u]),e.vertexWeights.push(l[4*u+1]),e.vertexWeights.push(l[4*u+2]),e.vertexWeights.push(l[4*u+3]),e.weightsIndices.push(c[4*a]),e.weightsIndices.push(c[4*a+1]),e.weightsIndices.push(c[4*a+2]),e.weightsIndices.push(c[4*a+3]),e.weightsIndices.push(c[4*h]),e.weightsIndices.push(c[4*h+1]),e.weightsIndices.push(c[4*h+2]),e.weightsIndices.push(c[4*h+3]),e.weightsIndices.push(c[4*u]),e.weightsIndices.push(c[4*u+1]),e.weightsIndices.push(c[4*u+2]),e.weightsIndices.push(c[4*u+3])),t.color&&(e.colors.push(o[3*a]),e.colors.push(o[3*a+1]),e.colors.push(o[3*a+2]),e.colors.push(o[3*h]),e.colors.push(o[3*h+1]),e.colors.push(o[3*h+2]),e.colors.push(o[3*u]),e.colors.push(o[3*u+1]),e.colors.push(o[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(r[3*a]),e.normal.push(r[3*a+1]),e.normal.push(r[3*a+2]),e.normal.push(r[3*h]),e.normal.push(r[3*h+1]),e.normal.push(r[3*h+2]),e.normal.push(r[3*u]),e.normal.push(r[3*u+1]),e.normal.push(r[3*u+2])),t.uv&&t.uv.forEach(function(t,i){void 0===e.uvs[i]&&(e.uvs[i]=[]),e.uvs[i].push(s[i][2*a]),e.uvs[i].push(s[i][2*a+1]),e.uvs[i].push(s[i][2*h]),e.uvs[i].push(s[i][2*h+1]),e.uvs[i].push(s[i][2*u]),e.uvs[i].push(s[i][2*u+1])})}addMorphTargets(e,t,i,r){if(0===i.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let o=this;i.forEach(function(i){i.rawTargets.forEach(function(i){let a=n.Objects.Geometry[i.geoID];void 0!==a&&o.genMorphGeometry(e,t,a,r,i.name)})})}genMorphGeometry(e,t,i,n,r){let o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==i.Vertices?i.Vertices.a:[],l=void 0!==i.Indexes?i.Indexes.a:[],c=new Float32Array(3*e.attributes.position.count);for(let e=0;e<l.length;e++){let t=3*l[e];c[t]=s[3*e],c[t+1]=s[3*e+1],c[t+2]=s[3*e+2]}let h=this.genBuffers({vertexIndices:o,vertexPositions:c}),d=new a.a$l(h.vertex,3);d.name=r||i.attrName,d.applyMatrix4(n),e.morphAttributes.position.push(d)}parseNormals(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Normals.a,r=[];return"IndexToDirect"===i&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:r,mappingType:t,referenceType:i}}parseUVs(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.UV.a,r=[];return"IndexToDirect"===i&&(r=e.UVIndex.a),{dataSize:2,buffer:n,indices:r,mappingType:t,referenceType:i}}parseVertexColors(e){let t=e.MappingInformationType,i=e.ReferenceInformationType,n=e.Colors.a,r=[];"IndexToDirect"===i&&(r=e.ColorIndex.a);for(let e=0,t=new a.Ilk;e<n.length;e+=4)t.fromArray(n,e).convertSRGBToLinear().toArray(n,e);return{dataSize:4,buffer:n,indices:r,mappingType:t,referenceType:i}}parseMaterialIndices(e){let t=e.MappingInformationType,i=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};let n=e.Materials.a,r=[];for(let e=0;e<n.length;++e)r.push(e);return{dataSize:1,buffer:n,indices:r,mappingType:t,referenceType:i}}parseNurbsGeometry(e){let t,i;let n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new a.u9r;let r=n-1,o=e.KnotVector.a,s=[],l=e.Points.a;for(let e=0,t=l.length;e<t;e+=4)s.push(new a.Ltg().fromArray(l,e));if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){t=r,i=o.length-1-t;for(let e=0;e<r;++e)s.push(s[e])}let c=new Z(r,o,s,t,i).getPoints(12*s.length);return new a.u9r().setFromPoints(c)}}class ee{parse(){let e=[],t=this.parseClips();if(void 0!==t)for(let i in t){let n=t[i],r=this.addClip(n);e.push(r)}return e}parseClips(){if(void 0===n.Objects.AnimationCurve)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=n.Objects.AnimationCurveNode,t=new Map;for(let i in e){let n=e[i];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){let e={id:n.id,attr:n.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){let t=n.Objects.AnimationCurve;for(let i in t){let n={id:t[i].id,times:t[i].KeyTime.a.map(ea),values:t[i].KeyValueFloat.a},o=r.get(n.id);if(void 0!==o){let t=o.parents[0].ID,i=o.parents[0].relationship;i.match(/X/)?e.get(t).curves.x=n:i.match(/Y/)?e.get(t).curves.y=n:i.match(/Z/)?e.get(t).curves.z=n:i.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=n)}}}parseAnimationLayers(e){let t=n.Objects.AnimationLayer,i=new Map;for(let s in t){let t=[],l=r.get(parseInt(s));void 0!==l&&(l.children.forEach(function(i,s){if(e.has(i.ID)){let l=e.get(i.ID);if(void 0!==l.curves.x||void 0!==l.curves.y||void 0!==l.curves.z){if(void 0===t[s]){let e=r.get(i.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID;if(void 0!==e){let r=n.Objects.Model[e.toString()];if(void 0===r){console.warn("THREE.FBXLoader: Encountered a unused curve.",i);return}let l={modelName:r.attrName?a.iUV.sanitizeNodeName(r.attrName):"",ID:r.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};o.traverse(function(e){e.ID===r.id&&(l.transform=e.matrix,e.userData.transformData&&(l.eulerOrder=e.userData.transformData.eulerOrder))}),l.transform||(l.transform=new a.yGw),"PreRotation"in r&&(l.preRotation=r.PreRotation.value),"PostRotation"in r&&(l.postRotation=r.PostRotation.value),t[s]=l}}t[s]&&(t[s][l.attr]=l)}else if(void 0!==l.curves.morph){if(void 0===t[s]){let e=r.get(i.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,o=r.get(e).parents[0].ID,l=r.get(o).parents[0].ID,c=r.get(l).parents[0].ID,h=n.Objects.Model[c],d={modelName:h.attrName?a.iUV.sanitizeNodeName(h.attrName):"",morphName:n.Objects.Deformer[e].attrName};t[s]=d}t[s][l.attr]=l}}}),i.set(parseInt(s),t))}return i}parseAnimStacks(e){let t=n.Objects.AnimationStack,i={};for(let n in t){let o=r.get(parseInt(n)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let a=e.get(o[0].ID);i[n]={name:t[n].attrName,layer:a}}return i}addClip(e){let t=[],i=this;return e.layer.forEach(function(e){t=t.concat(i.generateTracks(e))}),new a.m7l(e.name,-1,t)}generateTracks(e){let t=[],i=new a.Pa4,n=new a.Pa4;if(e.transform&&e.transform.decompose(i,new a._fP,n),i=i.toArray(),n=n.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){let n=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");void 0!==n&&t.push(n)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){let i=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);void 0!==i&&t.push(i)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){let i=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");void 0!==i&&t.push(i)}if(void 0!==e.DeformPercent){let i=this.generateMorphTrack(e);void 0!==i&&t.push(i)}return t}generateVectorTrack(e,t,i,n){let r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,i);return new a.yC1(e+"."+n,r,o)}generateRotationTrack(e,t,i,n,r){let o,s;if(void 0!==t.x&&void 0!==t.y&&void 0!==t.z){let e=this.interpolateRotations(t.x,t.y,t.z,r);o=e[0],s=e[1]}void 0!==i&&((i=i.map(a.M8C.degToRad)).push(r),i=new a.USm().fromArray(i),i=new a._fP().setFromEuler(i)),void 0!==n&&((n=n.map(a.M8C.degToRad)).push(r),n=new a.USm().fromArray(n),n=new a._fP().setFromEuler(n).invert());let l=new a._fP,c=new a.USm,h=[];if(!s||!o)return new a.iLg(e+".quaternion",[0],[0]);for(let e=0;e<s.length;e+=3)c.set(s[e],s[e+1],s[e+2],r),l.setFromEuler(c),void 0!==i&&l.premultiply(i),void 0!==n&&l.multiply(n),e>2&&0>new a._fP().fromArray(h,(e-3)/3*4).dot(l)&&l.set(-l.x,-l.y,-l.z,-l.w),l.toArray(h,e/3*4);return new a.iLg(e+".quaternion",o,h)}generateMorphTrack(e){let t=e.DeformPercent.curves.morph,i=t.values.map(function(e){return e/100}),n=o.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new a.dUE(e.modelName+".morphTargetInfluences["+n+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort(function(e,t){return e-t})).length>1){let e=1,i=t[0];for(let n=1;n<t.length;n++){let r=t[n];r!==i&&(t[e]=r,i=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,i){let n=[],r=-1,o=-1,a=-1;return e.forEach(function(e){if(t.x&&(r=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==r){let e=t.x.values[r];n.push(e),i[0]=e}else n.push(i[0]);if(-1!==o){let e=t.y.values[o];n.push(e),i[1]=e}else n.push(i[1]);if(-1!==a){let e=t.z.values[a];n.push(e),i[2]=e}else n.push(i[2])}),n}interpolateRotations(e,t,i,n){let r=[],o=[];r.push(e.times[0]),o.push(a.M8C.degToRad(e.values[0])),o.push(a.M8C.degToRad(t.values[0])),o.push(a.M8C.degToRad(i.values[0]));for(let s=1;s<e.values.length;s++){let l=[e.values[s-1],t.values[s-1],i.values[s-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;let c=l.map(a.M8C.degToRad),h=[e.values[s],t.values[s],i.values[s]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;let d=h.map(a.M8C.degToRad),u=[h[0]-l[0],h[1]-l[1],h[2]-l[2]],p=[Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){let t=Math.max(...p)/180,i=new a.USm(...c,n),l=new a.USm(...d,n),h=new a._fP().setFromEuler(i),u=new a._fP().setFromEuler(l);h.dot(u)&&u.set(-u.x,-u.y,-u.z,-u.w);let f=e.times[s-1],m=e.times[s]-f,v=new a._fP,y=new a.USm;for(let e=0;e<1;e+=1/t)v.copy(h.clone().slerp(u.clone(),e)),r.push(f+e*m),y.setFromQuaternion(v,n),o.push(y.x),o.push(y.y),o.push(y.z)}else r.push(e.times[s]),o.push(a.M8C.degToRad(e.values[s])),o.push(a.M8C.degToRad(t.values[s])),o.push(a.M8C.degToRad(i.values[s]))}return[r,o]}}class et{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new er,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,i=e.split(/[\r\n]+/);return i.forEach(function(e,n){let r=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(r||o)return;let a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):s?t.parseNodeProperty(e,s,i[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}),this.allNodes}parseNodeBegin(e,t){let i=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:i},o=this.parseNodeAttr(n),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,r):i in a?("PoseNode"===i?a.PoseNode.push(r):void 0!==a[i].id&&(a[i]={},a[i][a[i].id]=a[i]),""!==o.id&&(a[i][o.id]=r)):"number"==typeof o.id?(a[i]={},a[i][o.id]=r):"Properties70"!==i&&("PoseNode"===i?a[i]=[r]:a[i]=r),"number"==typeof o.id&&(r.id=o.id),""!==o.name&&(r.attrName=o.name),""!==o.type&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];""!==e[0]&&isNaN(t=parseInt(e[0]))&&(t=e[0]);let i="",n="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:i,type:n}}parseNodeProperty(e,t,i){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===r&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());let o=this.getCurrentNode();if("Properties70"===o.name){this.parseNodeSpecialProperty(e,n,r);return}if("C"===n){let e=r.split(",").slice(1),t=parseInt(e[0]),i=parseInt(e[1]),a=r.split(",").slice(3);a=a.map(function(e){return e.trim().replace(/^"/,"")}),n="connections",function(e,t){for(let i=0,n=e.length,r=t.length;i<r;i++,n++)e[n]=t[i]}(r=[t,i],a),void 0===o[n]&&(o[n]=[])}"Node"===n&&(o.id=r),n in o&&Array.isArray(o[n])?o[n].push(r):"a"!==n?o[n]=r:o.a=r,this.setCurrentProp(o,n),"a"===n&&","!==r.slice(-1)&&(o.a=ep(r))}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=ep(t.a))}parseNodeSpecialProperty(e,t,i){let n=i.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=n[0],o=n[1],a=n[2],s=n[3],l=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=ep(l)}this.getPrevNode()[r]={type:o,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class ei{parse(e){let t=new en(e);t.skip(23);let i=t.getUint32();if(i<6400)throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);let n=new er;for(;!this.endOfContent(t);){let e=this.parseNode(t,i);null!==e&&n.add(e.name,e)}return n}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let i={},n=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let o=e.getUint8(),a=e.getString(o);if(0===n)return null;let s=[];for(let t=0;t<r;t++)s.push(this.parseProperty(e));let l=s.length>0?s[0]:"",c=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(i.singleProperty=1===r&&e.getOffset()===n;n>e.getOffset();){let n=this.parseNode(e,t);null!==n&&this.parseSubNode(a,i,n)}return i.propertyList=s,"number"==typeof l&&(i.id=l),""!==c&&(i.attrName=c),""!==h&&(i.attrType=h),""!==a&&(i.name=a),i}parseSubNode(e,t,i){if(!0===i.singleProperty){let e=i.propertyList[0];Array.isArray(e)?(t[i.name]=i,i.a=e):t[i.name]=e}else if("Connections"===e&&"C"===i.name){let e=[];i.propertyList.forEach(function(t,i){0!==i&&e.push(t)}),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===i.name)Object.keys(i).forEach(function(e){t[e]=i[e]});else if("Properties70"===e&&"P"===i.name){let e,n=i.propertyList[0],r=i.propertyList[1],o=i.propertyList[2],a=i.propertyList[3];0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),e="Color"===r||"ColorRGB"===r||"Vector"===r||"Vector3D"===r||0===r.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],t[n]={type:r,type2:o,flag:a,value:e}}else void 0===t[i.name]?"number"==typeof i.id?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:"PoseNode"===i.name?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):void 0===t[i.name][i.id]&&(t[i.name][i.id]=i)}parseProperty(e){let t;let i=e.getString(1);switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n,r,o;let a=e.getUint32(),s=e.getUint32(),l=e.getUint32();if(0===s)switch(i){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}let c=new en(_((n=new Uint8Array(e.getArrayBuffer(l))).subarray((o=void 0,((15&n[0])!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&P(6,"invalid zlib data"),(n[1]>>5&1)==+!o&&P(6,"invalid zlib data: "+(32&n[1]?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2),-4),{i:2},r&&r.out,r&&r.dictionary).buffer);switch(i){case"b":case"c":return c.getBooleanArray(a);case"d":return c.getFloat64Array(a);case"f":return c.getFloat32Array(a);case"i":return c.getInt32Array(a);case"l":return c.getInt64Array(a)}break;default:throw Error("THREE.FBXLoader: Unknown property type "+i)}}}class en{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){let t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return(this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t)?(t=4294967295&~t,4294967295==(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e}getInt64Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=this.offset,i=new Uint8Array(this.dv.buffer,t,e);this.skip(e);let n=i.indexOf(0);return n>=0&&(i=new Uint8Array(this.dv.buffer,t,n)),this._textDecoder.decode(i)}}class er{add(e,t){this[e]=t}}function eo(e){let t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function ea(e){return e/46186158e3}let es=[];function el(e,t,i,n){let r;switch(n.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=i;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(r=n.indices[r]);let o=r*n.dataSize,a=o+n.dataSize;return function(e,t,i,n){for(let r=i,o=0;r<n;r++,o++)e[o]=t[r];return e}(es,n.buffer,o,a)}let ec=new a.USm,eh=new a.Pa4;function ed(e){let t=new a.yGw,i=new a.yGw,n=new a.yGw,r=new a.yGw,o=new a.yGw,s=new a.yGw,l=new a.yGw,c=new a.yGw,h=new a.yGw,d=new a.yGw,u=new a.yGw,p=new a.yGw,f=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(eh.fromArray(e.translation)),e.preRotation){let t=e.preRotation.map(a.M8C.degToRad);t.push(e.eulerOrder||a.USm.DEFAULT_ORDER),i.makeRotationFromEuler(ec.fromArray(t))}if(e.rotation){let t=e.rotation.map(a.M8C.degToRad);t.push(e.eulerOrder||a.USm.DEFAULT_ORDER),n.makeRotationFromEuler(ec.fromArray(t))}if(e.postRotation){let t=e.postRotation.map(a.M8C.degToRad);t.push(e.eulerOrder||a.USm.DEFAULT_ORDER),r.makeRotationFromEuler(ec.fromArray(t)),r.invert()}e.scale&&o.scale(eh.fromArray(e.scale)),e.scalingOffset&&l.setPosition(eh.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(eh.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(eh.fromArray(e.rotationOffset)),e.rotationPivot&&h.setPosition(eh.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(u.copy(e.parentMatrix),d.copy(e.parentMatrixWorld));let m=i.clone().multiply(n).multiply(r),v=new a.yGw;v.extractRotation(d);let y=new a.yGw;y.copyPosition(d);let g=y.clone().invert().multiply(d),b=v.clone().invert().multiply(g),w=new a.yGw;if(0===f)w.copy(v).multiply(m).multiply(b).multiply(o);else if(1===f)w.copy(v).multiply(b).multiply(m).multiply(o);else{let e=new a.yGw().scale(new a.Pa4().setFromMatrixScale(u)).clone().invert(),t=b.clone().multiply(e);w.copy(v).multiply(m).multiply(t).multiply(o)}let E=h.clone().invert(),k=s.clone().invert(),x=t.clone().multiply(c).multiply(h).multiply(i).multiply(n).multiply(r).multiply(E).multiply(l).multiply(s).multiply(o).multiply(k),T=new a.yGw().copyPosition(x),A=d.clone().multiply(T);return p.copyPosition(A),(x=p.clone().multiply(w)).premultiply(d.invert()),x}function eu(e){return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),"ZYX"):["ZYX","YZX","XZY","ZXY","YXZ","XYZ"][e]}function ep(e){return e.split(",").map(function(e){return parseFloat(e)})}function ef(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=e.byteLength),new TextDecoder().decode(new Uint8Array(e,t,i))}THREE.FBXLoader=Y,AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let e=this.data;if(!e.src)return;this.remove();let t=new THREE.FBXLoader;e.crossorigin&&t.setCrossOrigin(e.crossorigin),t.load(e.src,this.load.bind(this))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"fbx",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},974:function(e,t,i){let n;let r=i(8958)();e.exports=AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){this.model=null,this.loader=null,this.loaderPromise=(n=n||r("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js")).then(()=>{this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("Anonymous")})},update:function(){let e=this,t=this.el,i=this.data;i&&(this.remove(),this.loaderPromise.then(()=>{this.loader.load(i,function(i){e.model=i.scene,e.model.animations=i.animations,t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"gltf",model:e.model})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},5740:function(e,t,i){i(1985),i(681),i(5766),i(974),i(4154)},4154:function(e){e.exports=AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let e;let t=this.data;t.src&&(this.remove(),e=new THREE.ObjectLoader,t.crossorigin&&e.setCrossOrigin(t.crossorigin),e.load(t.src,e=>{e.traverse(e=>{e instanceof THREE.SkinnedMesh&&e.material&&(e.material.skinning=!!(e.geometry&&e.geometry.bones||[]).length)}),this.load(e)}))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"json",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},9348:function(e){e.exports=AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){let e=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!e)throw Error("No `checkpoint-controls` component found.");e.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}})},4636:function(e){function t(e,t,i,n){e&&(t=t||[],e.traverse(e=>{if(e.isMesh){var r;((r=e.material)?Array.isArray(r)?r:r.materials?r.materials:[r]:[]).forEach(e=>{(!e||"envMap"in e)&&(t.length&&-1===t.indexOf(e.name)||(e.envMap=i,e.reflectivity=n,e.needsUpdate=!0))})}}))}e.exports=AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){let e=this.data;this.texture=new THREE.CubeTextureLoader().load([e.path+"posx."+e.extension,e.path+"negx."+e.extension,e.path+"posy."+e.extension,e.path+"negy."+e.extension,e.path+"posz."+e.extension,e.path+"negz."+e.extension]),this.texture.format=THREE.RGBAFormat,this.object3dsetHandler=()=>{let e=this.el.getObject3D("mesh"),i=this.data;t(e,i.materials,this.texture,i.reflectivity)},this.object3dsetHandler(),this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(e){let i=this.data,n=this.el.getObject3D("mesh"),r=[],o=[];if(i.materials.length&&(e.materials?(r=i.materials.filter(t=>!e.materials.includes(t)),o=e.materials.filter(e=>!i.materials.includes(e))):r=i.materials),r.length&&t(n,r,this.texture,i.reflectivity),o.length&&t(n,o,null,1),e.materials&&i.reflectivity!==e.reflectivity){let r=i.materials.filter(t=>e.materials.includes(t));r.length&&t(n,r,this.texture,i.reflectivity)}this.data.enableBackground&&!e.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&e.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);let e=this.el.getObject3D("mesh"),i=this.data;t(e,i.materials,null,1),i.enableBackground&&this.setBackground(null)},setBackground:function(e){this.el.sceneEl.object3D.background=e}})},7363:function(e){e.exports=AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){let e=this.el;e.addEventListener("hit",this.onHit),e.addEventListener("gripdown",this.onGripClose),e.addEventListener("gripup",this.onGripOpen),e.addEventListener("trackpaddown",this.onGripClose),e.addEventListener("trackpadup",this.onGripOpen),e.addEventListener("triggerdown",this.onGripClose),e.addEventListener("triggerup",this.onGripOpen)},pause:function(){let e=this.el;e.removeEventListener("hit",this.onHit),e.removeEventListener("gripdown",this.onGripClose),e.removeEventListener("gripup",this.onGripOpen),e.removeEventListener("trackpaddown",this.onGripClose),e.removeEventListener("trackpadup",this.onGripOpen),e.removeEventListener("triggerdown",this.onGripClose),e.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){let e=this.hitEl;this.grabbing=!1,e&&(e.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(e){let t=e.detail.el;t.is(this.GRABBED_STATE)||!this.grabbing||this.hitEl||(t.addState(this.GRABBED_STATE),this.hitEl=t,this.constraint=new CANNON.LockConstraint(this.el.body,t.body),this.system.addConstraint(this.constraint))}})},5722:function(e,t,i){i(9348),i(4636),i(7363),i(6054),i(1266)},6054:function(e){e.exports=AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial),this.applyMaterial()},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){this.el.object3D.traverse(e=>{e.isMesh&&(e.material=this.material)})}})},1266:function(e){e.exports=AFRAME.registerComponent("sphere-collider",{schema:{enabled:{default:!0},interval:{default:80},objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.prevCheckTime=void 0,this.eventDetail={},this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},play:function(){let e=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(e,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){let e;let t=this.data;e=t.objects?this.el.sceneEl.querySelectorAll(t.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(e)},tick:function(){let e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Box3,o=[],a=new Map;return function(s){let l;if(!this.data.enabled)return;let c=this.prevCheckTime;if(c&&s-c<this.data.interval)return;this.prevCheckTime=s;let h=this.el,d=this.data;if(h.getObject3D("mesh"))o.length=0,a.clear(),h.object3D.getWorldPosition(e),h.object3D.getWorldScale(i),l=d.radius*Math.max(i.x,i.y,i.z),this.els.forEach(function(i){let s,c,h,d;i.isEntity&&(c=i.getObject3D("mesh"))&&(r.setFromObject(c).getSize(n),s=Math.sqrt(2*(d=Math.max(n.x,n.y,n.z)/2)*d),r.getCenter(t),s&&(h=e.distanceTo(t))<s+l&&(o.push(i),a.set(i,h)))}),o.sort((e,t)=>a.get(e)>a.get(t)?1:-1).forEach(this.handleHit),this.collisions.filter(e=>!a.has(e)).forEach(this.handleHitEnd),function(e,t){e.length=0;for(let i=0;i<t.length;i++)e[i]=t[i]}(this.collisions,o)}}(),handleHit:function(e){e.emit("hit"),e.addState(this.data.state),this.eventDetail.el=e,this.el.emit("hit",this.eventDetail)},handleHitEnd:function(e){e.emit("hitend"),e.removeState(this.data.state),this.eventDetail.el=e,this.el.emit("hitend",this.eventDetail)}})},2197:function(e,t,i){i(1416),i(4565),i(4581)},4565:function(e){e.exports=AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:function(){let e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(n,r){let o;let a=this.el,s=this.data,l=this.raycaster,c=s.speed*r/1e3;if(!s.active)return;if(!this.path.length){let t=this.el.object3D.position;this.group=this.group||this.system.getGroup(t),this.path=this.system.getPath(t,e.copy(s.destination),this.group)||[],a.emit("navigation-start")}if(!this.path.length){console.warn("[nav] Unable to find path to %o.",s.destination),this.el.setAttribute("nav-agent",{active:!1}),a.emit("navigation-end");return}let h=a.object3D.position,d=this.path[0];if(t.subVectors(d,h),t.length()<c){if(this.path.shift(),!this.path.length){this.el.setAttribute("nav-agent",{active:!1}),a.emit("navigation-end");return}i.copy(h),o=this.path[0]}else i.copy(t.setLength(c)).add(h),o=d;o.y=h.y,a.object3D.lookAt(o),l.ray.origin.copy(i),l.ray.origin.y+=1.5,l.ray.direction={x:0,y:-1,z:0};let u=l.intersectObject(this.system.getNavMesh());u.length?(t.subVectors(u[0].point,h),h.add(t.setLength(c))):h.copy(i)}}()})},1416:function(e){e.exports=AFRAME.registerComponent("nav-mesh",{schema:{nodeName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){let e;var t=this;let i=this.el.getObject3D("mesh");if(this.el.sceneEl.object3D,!i||(i.traverse(i=>{i.isMesh&&(!t.nodeName||i.name===t.nodeName)&&(e=i)}),!e))return;let n=e.geometry.clone();e.updateWorldMatrix(!0,!1),n.applyMatrix4(e.matrixWorld),this.system.setNavMeshGeometry(n),this.hasLoadedNavMesh=!0}})},4581:function(e,t,i){let{Pathfinding:n}=i(4562),r=new n,o="level";e.exports=AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(e){this.navMesh=new THREE.Mesh(e),r.setZoneData(o,n.createZone(e)),Array.from(this.agents).forEach(e=>e.updateNavLocation())},getNavMesh:function(){return this.navMesh},addAgent:function(e){this.agents.add(e)},removeAgent:function(e){this.agents.delete(e)},getPath:function(e,t,i){return this.navMesh?r.findPath(e,t,o,i):null},getGroup:function(e){return this.navMesh?r.getGroup(o,e):null},getNode:function(e,t){return this.navMesh?r.getClosestNode(e,o,t,!0):null},clampStep:function(e,t,i,n,a){return this.navMesh?n?r.clampStep(e,t,n,o,i,a):(a.copy(t),this.getNode(t,i)):(a.copy(t),null)}})},5705:function(e){e.exports=AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}})},524:function(e){e.exports.Primitive=AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),e.exports.Component=AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){let e=this.el,t=this.data,i=e.components.material,n=new THREE.PlaneGeometry(t.width,t.depth,t.density,t.density);this.waves=[];let r=n.getAttribute("position");for(let e=0;e<r.count;e++)this.waves.push({z:r.getZ(e),ang:Math.random()*Math.PI*2,amp:t.amplitude+Math.random()*t.amplitudeVariance,speed:(t.speed+Math.random()*t.speedVariance)/1e3});i||((i={}).material=new THREE.MeshPhongMaterial({color:t.color,transparent:t.opacity<1,opacity:t.opacity,flatShading:!0})),this.mesh=new THREE.Mesh(n,i.material),e.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(e,t){if(!t)return;let i=this.mesh.geometry.getAttribute("position");for(let e=0;e<i.count;e++){let n=this.waves[e],r=n.z+Math.sin(n.ang)*n.amp;i.setZ(e,r),n.ang+=n.speed*t}i.needsUpdate=!0}})},9004:function(e){e.exports.Primitive=AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),e.exports.Component=AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){let e=this.el,t=this.data,i=e.components.material;if(!t.path.length){console.error("[a-tube] `path` property expected but not found.");return}let n=new THREE.CatmullRomCurve3(t.path.map(function(e){return e=e.split(" "),new THREE.Vector3(Number(e[0]),Number(e[1]),Number(e[2]))})),r=new THREE.TubeGeometry(n,t.segments,t.radius,t.radialSegments,t.closed);i||((i={}).material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(r,i.material),this.el.setObject3D("mesh",this.mesh)},update:function(e){Object.keys(e).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}})},9420:function(e,t,i){i(5705),i(524),i(9004)},8272:function(e){var t;window,t=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,(function(t){return e[t]}).bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);var n,r=function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},o=function(e){return Math.PI/180*e},a=new Map,s=function(e){a.has(e)&&clearTimeout(a.get(e)),a.set(e,setTimeout(e,100))},l=function(e,t,i){for(var n,r=t.split(/[ ,]+/g),o=0;o<r.length;o+=1)n=r[o],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},c=function(e,t,i){for(var n,r=t.split(/[ ,]+/g),o=0;o<r.length;o+=1)n=r[o],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},h=function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},d=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},u=function(e,t){t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},p=function(e,t,i){var n=f(e);for(var r in n)if(n.hasOwnProperty(r)){if("string"==typeof t)n[r]=t+" "+i;else{for(var o="",a=0,s=t.length;a<s;a+=1)o+=t[a]+" "+i+", ";n[r]=o.slice(0,-2)}}return n},f=function(e){var t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},m=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},v=function(e,t){if(e.length)for(var i=0,n=e.length;i<n;i+=1)t(e[i]);else t(e)},y="ontouchstart"in window,g=!!window.PointerEvent,b=!!window.MSPointerEvent,w={start:"mousedown",move:"mousemove",end:"mouseup"},E={};function k(){}function x(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=x.id,x.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function T(e,t){this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=e,this.id=T.id,T.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},this.config(t),"static"!==this.options.mode&&"semi"!==this.options.mode||(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1);var i=getComputedStyle(this.options.zone.parentElement);return i&&"flex"===i.display&&(this.parentIsFlex=!0),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}function A(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=d(),t.config(e),t.prepareCollections();var i=function(){var e;t.collections.forEach(function(i){i.forEach(function(i){e=i.el.getBoundingClientRect(),i.position={x:t.scroll.x+e.left,y:t.scroll.y+e.top}})})};l(window,"resize",function(){s(i)});var n=function(){t.scroll=d()};return l(window,"scroll",function(){s(n)}),t.collections}g?n={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:b?n={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:y?(n={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},E=w):n=w,k.prototype.on=function(e,t){var i,n=e.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var r=0;r<n.length;r+=1)i=n[r],this._handlers_[i]=this._handlers_[i]||[],this._handlers_[i].push(t);return this},k.prototype.off=function(e,t){return this._handlers_=this._handlers_||{},void 0===e?this._handlers_={}:void 0===t?this._handlers_[e]=null:this._handlers_[e]&&this._handlers_[e].indexOf(t)>=0&&this._handlers_[e].splice(this._handlers_[e].indexOf(t),1),this},k.prototype.trigger=function(e,t){var i,n=this,r=e.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var o=0;o<r.length;o+=1)i=r[o],n._handlers_[i]&&n._handlers_[i].length&&n._handlers_[i].forEach(function(e){e.call(n,{type:i,target:n},t)})},k.prototype.config=function(e){this.options=this.defaults||{},e&&(this.options=function(e,t){var i={};for(var n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i}(this.options,e))},k.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){"function"==typeof i["on"+t]?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},l(e,n[t],i._domHandlers_[t]),E[t]&&l(e,E[t],i._domHandlers_[t]),i},k.prototype.unbindEvt=function(e,t){return this._domHandlers_=this._domHandlers_||{},c(e,n[t],this._domHandlers_[t]),E[t]&&c(e,E[t],this._domHandlers_[t]),delete this._domHandlers_[t],this},x.prototype=new k,x.constructor=x,x.id=0,x.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},x.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=function(e,t){var i=f(e);for(var n in i)i.hasOwnProperty(n)&&(i[n]="50%");return i}("borderRadius",0),i=p("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},m(n.el,i),"circle"===this.options.shape&&m(n.back,t),m(n.front,t),this.applyStyles(n),this},x.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this},x.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},x.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},x.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},x.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)},t.options.fadeTime)),t},x.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=i,"function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){var i=t.options.restJoystick,n={};n.x=!0===i||!1!==i.x?0:t.instance.frontPosition.x,n.y=!0===i||!1!==i.y?0:t.instance.frontPosition.y,t.setPosition(e,n)}return t},x.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var n=i.options.fadeTime+"ms",r={};r.front=p("transition",["transform"],n);var o={front:{}};o.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(r),i.applyStyles(o),i.restTimeout=setTimeout(function(){"function"==typeof e&&e.call(i),i.restCallback()},i.options.fadeTime)},x.prototype.restCallback=function(){var e={};e.front=p("transition","none",""),this.applyStyles(e),this.trigger("rested",this.instance)},x.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},x.prototype.computeDirection=function(e){var t,i,n,r=e.angle.radian,o=Math.PI/4,a=Math.PI/2;if(r>o&&r<3*o&&!e.lockX?t="up":r>-o&&r<=o&&!e.lockY?t="left":r>-(3*o)&&r<=-o&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(i=r>-a&&r<a?"left":"right"),e.lockX||(n=r>0?"up":"down"),e.force>this.options.threshold){var s,l={};for(s in this.direction)this.direction.hasOwnProperty(s)&&(l[s]=this.direction[s]);var c={};for(s in this.direction={x:i,y:n,angle:t},e.direction=this.direction,l)l[s]===this.direction[s]&&(c[s]=!0);if(c.x&&c.y&&c.angle)return e;c.x&&c.y||this.trigger("plain",e),c.x||this.trigger("plain:"+i,e),c.y||this.trigger("plain:"+n,e),c.angle||this.trigger("dir dir:"+t,e)}else this.resetDirection();return e},T.prototype=new k,T.constructor=T,T.id=0,T.prototype.prepareNipples=function(){var e=this.nipples;e.on=this.on.bind(this),e.off=this.off.bind(this),e.options=this.options,e.destroy=this.destroy.bind(this),e.ids=this.ids,e.id=this.id,e.processOnMove=this.processOnMove.bind(this),e.processOnEnd=this.processOnEnd.bind(this),e.get=function(t){if(void 0===t)return e[0];for(var i=0,n=e.length;i<n;i+=1)if(e[i].identifier===t)return e[i];return!1}},T.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},T.prototype.begin=function(){var e=this.options;if("static"===e.mode){var t=this.createNipple(e.position,this.manager.getIdentifier());t.add(),this.idles.push(t)}},T.prototype.createNipple=function(e,t){var i=this.manager.scroll,n={},r=this.options,o=this.parentIsFlex?i.x:i.x+this.box.left,a=this.parentIsFlex?i.y:i.y+this.box.top;if(e.x&&e.y)n={x:e.x-o,y:e.y-a};else if(e.top||e.right||e.bottom||e.left){var s=document.createElement("DIV");s.style.display="hidden",s.style.top=e.top,s.style.right=e.right,s.style.bottom=e.bottom,s.style.left=e.left,s.style.position="absolute",r.zone.appendChild(s);var l=s.getBoundingClientRect();r.zone.removeChild(s),n=e,e={x:l.left+i.x,y:l.top+i.y}}var c=new x(this,{color:r.color,size:r.size,threshold:r.threshold,fadeTime:r.fadeTime,dataOnly:r.dataOnly,restJoystick:r.restJoystick,restOpacity:r.restOpacity,mode:r.mode,identifier:t,position:e,zone:r.zone,frontPosition:{x:0,y:0},shape:r.shape});return r.dataOnly||(u(c.ui.el,n),u(c.ui.front,c.frontPosition)),this.nipples.push(c),this.trigger("added "+c.identifier+":added",c),this.manager.trigger("added "+c.identifier+":added",c),this.bindNipple(c),c},T.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},T.prototype.bindNipple=function(e){var t,i=this,n=function(e,n){t=e.type+" "+n.id+":"+e.type,i.trigger(t,n)};e.on("destroyed",i.onDestroyed.bind(i)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},T.prototype.pressureFn=function(e,t,i){var n=this,r=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval((function(){var i=e.force||e.pressure||e.webkitForce||0;i!==r&&(t.trigger("pressure",i),n.trigger("pressure "+t.identifier+":pressure",i),r=i)}).bind(n),100)},T.prototype.onstart=function(e){var t=this,i=t.options,n=e;return e=h(e),t.updateBox(),v(e,function(r){t.actives.length<i.maxNumberOfNipples?t.processOnStart(r):n.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(i){if(0>Object.values(n.touches).findIndex(function(e){return e.identifier===i})){var r=[e[0]];r.identifier=i,t.processOnEnd(r)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(r))}),t.manager.bindDocument(),!1},T.prototype.processOnStart=function(e){var t,i=this,n=i.options,o=i.manager.getIdentifier(e),a=e.force||e.pressure||e.webkitForce||0,s={x:e.pageX,y:e.pageY},l=i.getOrCreate(o,s);l.identifier!==o&&i.manager.removeIdentifier(l.identifier),l.identifier=o;var c=function(t){t.trigger("start",t),i.trigger("start "+t.id+":start",t),t.show(),a>0&&i.pressureFn(e,t,t.identifier),i.processOnMove(e)};if((t=i.idles.indexOf(l))>=0&&i.idles.splice(t,1),i.actives.push(l),i.ids.push(l.identifier),"semi"!==n.mode)c(l);else{if(!(r(s,l.position)<=n.catchDistance))return l.destroy(),void i.processOnStart(e);c(l)}return l},T.prototype.getOrCreate=function(e,t){var i,n=this.options;return/(semi|static)/.test(n.mode)?(i=this.idles[0])?(this.idles.splice(0,1),i):"semi"===n.mode?this.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):i=this.createNipple(t,e)},T.prototype.processOnMove=function(e){var t=this.options,i=this.manager.getIdentifier(e),n=this.nipples.get(i),a=this.manager.scroll;if(isNaN(e.buttons)?0!==e.pressure:0!==e.buttons){if(!n)return console.error("Found zombie joystick with ID "+i),void this.manager.removeIdentifier(i);if(t.dynamicPage){var s,l,c=n.el.getBoundingClientRect();n.position={x:a.x+c.left,y:a.y+c.top}}n.identifier=i;var h=n.options.size/2,d={x:e.pageX,y:e.pageY};t.lockX&&(d.y=n.position.y),t.lockY&&(d.x=n.position.x);var u,p,f,m,v,y,g,b,w,E=r(d,n.position),k=(u=d,f=(p=n.position).x-u.x,180/Math.PI*Math.atan2(p.y-u.y,f)),x=o(k),T=E/h,A={distance:E,position:d};if("circle"===n.options.shape?(m=Math.min(E,h),y=n.position,g=m,w={x:0,y:0},b=o(b=k),w.x=y.x-g*Math.cos(b),w.y=y.y-g*Math.sin(b),v=w):(s=d,l=n.position,m=r(v={x:Math.min(Math.max(s.x,l.x-h),l.x+h),y:Math.min(Math.max(s.y,l.y-h),l.y+h)},n.position)),t.follow){if(E>h){var M=d.x-v.x,N=d.y-v.y;n.position.x+=M,n.position.y+=N,n.el.style.top=n.position.y-(this.box.top+a.y)+"px",n.el.style.left=n.position.x-(this.box.left+a.x)+"px",E=r(d,n.position)}}else d=v,E=m;var C=d.x-n.position.x,R=d.y-n.position.y;n.frontPosition={x:C,y:R},t.dataOnly||(n.ui.front.style.transform="translate("+C+"px,"+R+"px)");var O={identifier:n.identifier,position:d,force:T,pressure:e.force||e.pressure||e.webkitForce||0,distance:E,angle:{radian:x,degree:k},vector:{x:C/h,y:-R/h},raw:A,instance:n,lockX:t.lockX,lockY:t.lockY};(O=n.computeDirection(O)).angle={radian:o(180-k),degree:180-k},n.trigger("move",O),this.trigger("move "+n.id+":move",O)}else this.processOnEnd(e)},T.prototype.processOnEnd=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),o=t.manager.removeIdentifier(r.identifier);r&&(i.dataOnly||r.hide(function(){"dynamic"===i.mode&&(r.trigger("removed",r),t.trigger("removed "+r.id+":removed",r),t.manager.trigger("removed "+r.id+":removed",r),r.destroy())}),clearInterval(t.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),t.trigger("end "+r.id+":end",r),t.ids.indexOf(r.identifier)>=0&&t.ids.splice(t.ids.indexOf(r.identifier),1),t.actives.indexOf(r)>=0&&t.actives.splice(t.actives.indexOf(r),1),/(semi|static)/.test(i.mode)?t.idles.push(r):t.nipples.indexOf(r)>=0&&t.nipples.splice(t.nipples.indexOf(r),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[o.id]=o.identifier))},T.prototype.onDestroyed=function(e,t){this.nipples.indexOf(t)>=0&&this.nipples.splice(this.nipples.indexOf(t),1),this.actives.indexOf(t)>=0&&this.actives.splice(this.actives.indexOf(t),1),this.idles.indexOf(t)>=0&&this.idles.splice(this.idles.indexOf(t),1),this.ids.indexOf(t.identifier)>=0&&this.ids.splice(this.ids.indexOf(t.identifier),1),this.manager.removeIdentifier(t.identifier),this.manager.unbindDocument()},T.prototype.destroy=function(){for(var e in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach(function(e){e.destroy()}),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(e)&&clearInterval(this.pressureIntervals[e]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()},A.prototype=new k,A.constructor=A,A.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(e){return!(i=e.get(t))}),i}},A.prototype.create=function(e){return this.createCollection(e)},A.prototype.createCollection=function(e){var t=new T(this,e);return this.bindCollection(t),this.collections.push(t),t},A.prototype.bindCollection=function(e){var t,i=this,n=function(e,n){t=e.type+" "+n.id+":"+e.type,i.trigger(t,n)};e.on("destroyed",i.onDestroyed.bind(i)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},A.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},A.prototype.unbindDocument=function(e){Object.keys(this.ids).length&&!0!==e||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},A.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},A.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t},A.prototype.onmove=function(e){return this.onAny("move",e),!1},A.prototype.onend=function(e){return this.onAny("end",e),!1},A.prototype.oncancel=function(e){return this.onAny("end",e),!1},A.prototype.onAny=function(e,t){var i,n=this,r="processOn"+e.charAt(0).toUpperCase()+e.slice(1);return v(t=h(t),function(e){i=n.getIdentifier(e),v(n.collections,(function(e,t,i){i.ids.indexOf(t)>=0&&(i[r](e),e._found_=!0)}).bind(null,e,i)),e._found_||n.removeIdentifier(i)}),!1},A.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach(function(e){e.destroy()}),this.off()},A.prototype.onDestroyed=function(e,t){if(0>this.collections.indexOf(t))return!1;this.collections.splice(this.collections.indexOf(t),1)};var M=new A;t.default={create:function(e){return M.create(e)},factory:M}}]).default},e.exports=t()},4562:function(e,t,i){"use strict";i.r(t),i.d(t,{Pathfinding:function(){return s},PathfindingHelper:function(){return l}});var n=i(2079);class r{static roundNumber(e,t){let i=Math.pow(10,t);return Math.round(e*i)/i}static sample(e){return e[Math.floor(Math.random()*e.length)]}static distanceToSquared(e,t){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z;return i*i+n*n+r*r}static isPointInPoly(e,t){for(var i=!1,n=-1,r=e.length,o=r-1;++n<r;o=n)(e[n].z<=t.z&&t.z<e[o].z||e[o].z<=t.z&&t.z<e[n].z)&&t.x<(e[o].x-e[n].x)*(t.z-e[n].z)/(e[o].z-e[n].z)+e[n].x&&(i=!i);return i}static isVectorInPolygon(e,t,i){var n=1e5,r=-1e5,o=[];return t.vertexIds.forEach(e=>{n=Math.min(i[e].y,n),r=Math.max(i[e].y,r),o.push(i[e])}),!!(e.y<r+.5&&e.y>n-.5&&this.isPointInPoly(o,e))}static triarea2(e,t,i){return(i.x-e.x)*(t.z-e.z)-(t.x-e.x)*(i.z-e.z)}static vequal(e,t){return 1e-5>this.distanceToSquared(e,t)}static mergeVertices(e,t=1e-4){t=Math.max(t,Number.EPSILON);for(var i={},r=e.getIndex(),o=e.getAttribute("position"),a=r?r.count:o.count,s=0,l=[],c=[],h=Math.log10(1/t),d=Math.pow(10,h),u=0;u<a;u++){var p=r?r.getX(u):u,f="";(f+=~~(o.getX(p)*d)+","+~~(o.getY(p)*d)+","+~~(o.getZ(p)*d)+",")in i?l.push(i[f]):(c.push(o.getX(p)),c.push(o.getY(p)),c.push(o.getZ(p)),i[f]=s,l.push(s),s++)}let m=new n.TlE(new Float32Array(c),o.itemSize,o.normalized),v=new n.u9r;return v.setAttribute("position",m),v.setIndex(l),v}}class o{constructor(e){this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.sinkDown(this.content.length-1)}pop(){let e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e}remove(e){let t=this.content.indexOf(e),i=this.content.pop();t!==this.content.length-1&&(this.content[t]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))}size(){return this.content.length}rescoreElement(e){this.sinkDown(this.content.indexOf(e))}sinkDown(e){let t=this.content[e];for(;e>0;){let i=(e+1>>1)-1,n=this.content[i];if(!(this.scoreFunction(t)<this.scoreFunction(n)))break;this.content[i]=t,this.content[e]=n,e=i}}bubbleUp(e){let t=this.content.length,i=this.content[e],n=this.scoreFunction(i);for(;;){let r=e+1<<1,o=r-1,a,s=null;if(o<t&&(a=this.scoreFunction(this.content[o]))<n&&(s=o),r<t&&this.scoreFunction(this.content[r])<(null===s?n:a)&&(s=r),null===s)break;this.content[e]=this.content[s],this.content[s]=i,e=s}}}class a{constructor(){this.portals=[]}push(e,t){void 0===t&&(t=e),this.portals.push({left:e,right:t})}stringPull(){let e=this.portals,t=[],i,n,o,a=0,s=0,l=0;i=e[0].left,n=e[0].left,o=e[0].right,t.push(i);for(let c=1;c<e.length;c++){let h=e[c].left,d=e[c].right;if(0>=r.triarea2(i,o,d)){if(!(r.vequal(i,o)||r.triarea2(i,n,d)>0)){t.push(n),i=n,a=s,n=i,o=i,s=a,l=a,c=a;continue}o=d,l=c}if(r.triarea2(i,n,h)>=0){if(!(r.vequal(i,n)||0>r.triarea2(i,o,h))){t.push(o),i=o,a=l,n=i,o=i,s=a,l=a,c=a;continue}n=h,s=c}}return 0!==t.length&&r.vequal(t[t.length-1],e[e.length-1].left)||t.push(e[e.length-1].left),this.path=t,t}}class s{constructor(){this.zones={}}static createZone(e,t=1e-4){return(class{static buildZone(e,t){let i=this._buildNavigationMesh(e,t),o={};i.vertices.forEach(e=>{e.x=r.roundNumber(e.x,2),e.y=r.roundNumber(e.y,2),e.z=r.roundNumber(e.z,2)}),o.vertices=i.vertices;let a=this._buildPolygonGroups(i);return o.groups=Array(a.length),a.forEach((e,t)=>{let i=new Map;e.forEach((e,t)=>{i.set(e,t)});let a=Array(e.length);e.forEach((e,t)=>{let s=[];e.neighbours.forEach(e=>s.push(i.get(e)));let l=[];e.neighbours.forEach(t=>l.push(this._getSharedVerticesInOrder(e,t)));let c=new n.Pa4(0,0,0);c.add(o.vertices[e.vertexIds[0]]),c.add(o.vertices[e.vertexIds[1]]),c.add(o.vertices[e.vertexIds[2]]),c.divideScalar(3),c.x=r.roundNumber(c.x,2),c.y=r.roundNumber(c.y,2),c.z=r.roundNumber(c.z,2),a[t]={id:t,neighbours:s,vertexIds:e.vertexIds,centroid:c,portals:l}}),o.groups[t]=a}),o}static _buildNavigationMesh(e,t){return e=r.mergeVertices(e,t),this._buildPolygonsFromGeometry(e)}static _spreadGroupId(e){let t=new Set([e]);for(;t.size>0;){let i=t;t=new Set,i.forEach(i=>{i.group=e.group,i.neighbours.forEach(e=>{void 0===e.group&&t.add(e)})})}}static _buildPolygonGroups(e){let t=[];return e.polygons.forEach(e=>{void 0!==e.group?t[e.group].push(e):(e.group=t.length,this._spreadGroupId(e),t.push([e]))}),t}static _buildPolygonNeighbours(e,t){let i=new Set,n=t[e.vertexIds[1]],r=t[e.vertexIds[2]];return t[e.vertexIds[0]].forEach(t=>{t!==e&&(n.includes(t)||r.includes(t))&&i.add(t)}),n.forEach(t=>{t!==e&&r.includes(t)&&i.add(t)}),i}static _buildPolygonsFromGeometry(e){let t=[],i=[],r=e.attributes.position,o=e.index,a=[];for(let e=0;e<r.count;e++)i.push((new n.Pa4).fromBufferAttribute(r,e)),a[e]=[];for(let i=0;i<e.index.count;i+=3){let e=o.getX(i),n=o.getX(i+1),r=o.getX(i+2),s={vertexIds:[e,n,r],neighbours:null};t.push(s),a[e].push(s),a[n].push(s),a[r].push(s)}return t.forEach(e=>{e.neighbours=this._buildPolygonNeighbours(e,a)}),{polygons:t,vertices:i}}static _getSharedVerticesInOrder(e,t){let i=e.vertexIds,n=i[0],r=i[1],o=i[2],a=t.vertexIds,s=a.includes(n),l=a.includes(r),c=a.includes(o);return s&&l&&c?Array.from(i):s&&l?[n,r]:l&&c?[r,o]:s&&c?[o,n]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}).buildZone(e,t)}setZoneData(e,t){this.zones[e]=t}getRandomNode(e,t,i,o){if(!this.zones[e])return new n.Pa4;i=i||null,o=o||0;let a=[];return this.zones[e].groups[t].forEach(e=>{i&&o?r.distanceToSquared(i,e.centroid)<o*o&&a.push(e.centroid):a.push(e.centroid)}),r.sample(a)||new n.Pa4}getClosestNode(e,t,i,n=!1){let o=this.zones[t].vertices,a=null,s=1/0;return this.zones[t].groups[i].forEach(t=>{let i=r.distanceToSquared(t.centroid,e);i<s&&(!n||r.isVectorInPolygon(e,t,o))&&(a=t,s=i)}),a}findPath(e,t,i,s){let l=this.zones[i].groups[s],c=this.zones[i].vertices,h=this.getClosestNode(e,i,s,!0),d=this.getClosestNode(t,i,s,!0);if(!h||!d)return null;let u=(class{static init(e){for(let t=0;t<e.length;t++){let i=e[t];i.f=0,i.g=0,i.h=0,i.cost=1,i.visited=!1,i.closed=!1,i.parent=null}}static cleanUp(e){for(let t=0;t<e.length;t++){let i=e[t];delete i.f,delete i.g,delete i.h,delete i.cost,delete i.visited,delete i.closed,delete i.parent}}static heap(){return new o(function(e){return e.f})}static search(e,t,i){this.init(e);let n=this.heap();for(n.push(t);n.size()>0;){let t=n.pop();if(t===i){let e=t,i=[];for(;e.parent;)i.push(e),e=e.parent;return this.cleanUp(i),i.reverse()}t.closed=!0;let r=this.neighbours(e,t);for(let e=0,o=r.length;e<o;e++){let o=r[e];if(o.closed)continue;let a=t.g+o.cost,s=o.visited;if(!s||a<o.g){if(o.visited=!0,o.parent=t,!o.centroid||!i.centroid)throw Error("Unexpected state");o.h=o.h||this.heuristic(o.centroid,i.centroid),o.g=a,o.f=o.g+o.h,s?n.rescoreElement(o):n.push(o)}}}return[]}static heuristic(e,t){return r.distanceToSquared(e,t)}static neighbours(e,t){let i=[];for(let n=0;n<t.neighbours.length;n++)i.push(e[t.neighbours[n]]);return i}}).search(l,h,d),p=new a;p.push(e);for(let e=0;e<u.length;e++){let t=u[e],i=u[e+1];if(i){let e=function(e,t){for(var i=0;i<e.neighbours.length;i++)if(e.neighbours[i]===t.id)return e.portals[i]}(t,i);p.push(c[e[0]],c[e[1]])}}p.push(t),p.stringPull();let f=p.path.map(e=>new n.Pa4(e.x,e.y,e.z));return f.shift(),f}}s.prototype.getGroup=function(){let e=new n.JOQ;return function(t,i,n=!1){if(!this.zones[t])return null;let o=null,a=2500,s=this.zones[t];for(let t=0;t<s.groups.length;t++)for(let l of s.groups[t]){if(n&&(e.setFromCoplanarPoints(s.vertices[l.vertexIds[0]],s.vertices[l.vertexIds[1]],s.vertices[l.vertexIds[2]]),.01>Math.abs(e.distanceToPoint(i)))&&r.isPointInPoly([s.vertices[l.vertexIds[0]],s.vertices[l.vertexIds[1]],s.vertices[l.vertexIds[2]]],i))return t;let c=r.distanceToSquared(l.centroid,i);c<a&&(o=t,a=c)}return o}}(),s.prototype.clampStep=function(){let e=new n.Pa4,t=new n.JOQ,i=new n.CJI,r=new n.Pa4,o,a,s=new n.Pa4;return function(n,l,c,h,d,u){let p=this.zones[h].vertices,f=this.zones[h].groups[d],m=[c],v={};v[c.id]=0,o=void 0,s.set(0,0,0),a=1/0,t.setFromCoplanarPoints(p[c.vertexIds[0]],p[c.vertexIds[1]],p[c.vertexIds[2]]),t.projectPoint(l,e),r.copy(e);for(let t=m.pop();t;t=m.pop()){i.set(p[t.vertexIds[0]],p[t.vertexIds[1]],p[t.vertexIds[2]]),i.closestPointToPoint(r,e),e.distanceToSquared(r)<a&&(o=t,s.copy(e),a=e.distanceToSquared(r));let n=v[t.id];if(!(n>2))for(let e=0;e<t.neighbours.length;e++){let i=f[t.neighbours[e]];i.id in v||(m.push(i),v[i.id]=n+1)}}return u.copy(s),o}}();class l extends n.Tme{constructor(){super(),this._playerMarker=new n.Kj0(new n.xo$(.25,32,32),new n.vBJ({color:15631215})),this._targetMarker=new n.Kj0(new n.DvJ(.3,.3,.3),new n.vBJ({color:14469912})),this._nodeMarker=new n.Kj0(new n.DvJ(.1,.8,.1),new n.vBJ({color:4417387})),this._stepMarker=new n.Kj0(new n.DvJ(.1,1,.1),new n.vBJ({color:14472114})),this._pathMarker=new n.Tme,this._pathLineMaterial=new n.nls({color:41903,linewidth:2}),this._pathPointMaterial=new n.vBJ({color:41903}),this._pathPointGeometry=new n.xo$(.08),this._markers=[this._playerMarker,this._targetMarker,this._nodeMarker,this._stepMarker,this._pathMarker],this._markers.forEach(e=>{e.visible=!1,this.add(e)})}setPath(e){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);e=[this._playerMarker.position].concat(e);let t=new n.u9r;t.setAttribute("position",new n.TlE(new Float32Array(3*e.length),3));for(let i=0;i<e.length;i++)t.attributes.position.setXYZ(i,e[i].x,e[i].y+.2,e[i].z);this._pathMarker.add(new n.x12(t,this._pathLineMaterial));for(let t=0;t<e.length-1;t++){let i=new n.Kj0(this._pathPointGeometry,this._pathPointMaterial);i.position.copy(e[t]),i.position.y+=.2,this._pathMarker.add(i)}return this._pathMarker.visible=!0,this}setPlayerPosition(e){return this._playerMarker.position.copy(e),this._playerMarker.visible=!0,this}setTargetPosition(e){return this._targetMarker.position.copy(e),this._targetMarker.visible=!0,this}setNodePosition(e){return this._nodeMarker.position.copy(e),this._nodeMarker.visible=!0,this}setStepPosition(e){return this._stepMarker.position.copy(e),this._stepMarker.visible=!0,this}reset(){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);return this._markers.forEach(e=>{e.visible=!1}),this}}},3257:function(e,t,i){"use strict";i.d(t,{I:function(){return W}});var n=i(2079),r={},o=Uint8Array,a=Uint16Array,s=Int32Array,l=new o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),c=new o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),h=new o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=function(e,t){for(var i=new a(31),n=0;n<31;++n)i[n]=t+=1<<e[n-1];for(var r=new s(i[30]),n=1;n<30;++n)for(var o=i[n];o<i[n+1];++o)r[o]=o-i[n]<<5|n;return{b:i,r:r}},u=d(l,2),p=u.b,f=u.r;p[28]=258,f[258]=28;for(var m=d(c,0),v=m.b,y=m.r,g=new a(32768),b=0;b<32768;++b){var w=(43690&b)>>1|(21845&b)<<1;w=(61680&(w=(52428&w)>>2|(13107&w)<<2))>>4|(3855&w)<<4,g[b]=((65280&w)>>8|(255&w)<<8)>>1}for(var E=function(e,t,i){for(var n,r=e.length,o=0,s=new a(t);o<r;++o)e[o]&&++s[e[o]-1];var l=new a(t);for(o=1;o<t;++o)l[o]=l[o-1]+s[o-1]<<1;if(i){n=new a(1<<t);var c=15-t;for(o=0;o<r;++o)if(e[o])for(var h=o<<4|e[o],d=t-e[o],u=l[e[o]-1]++<<d,p=u|(1<<d)-1;u<=p;++u)n[g[u]>>c]=h}else for(o=0,n=new a(r);o<r;++o)e[o]&&(n[o]=g[l[e[o]-1]++]>>15-e[o]);return n},k=new o(288),b=0;b<144;++b)k[b]=8;for(var b=144;b<256;++b)k[b]=9;for(var b=256;b<280;++b)k[b]=7;for(var b=280;b<288;++b)k[b]=8;for(var x=new o(32),b=0;b<32;++b)x[b]=5;var T=E(k,9,1),A=E(x,5,1),M=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},N=function(e,t,i){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&i},C=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},R=function(e){return(e+7)/8|0},O=function(e,t,i){return(null==t||t<0)&&(t=0),(null==i||i>e.length)&&(i=e.length),new o(e.subarray(t,i))},D=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],S=function(e,t,i){var n=Error(t||D[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,S),!i)throw n;return n},I=function(e,t,i,n){var r=e.length,a=n?n.length:0;if(!r||t.f&&!t.l)return i||new o(0);var s=!i,d=s||2!=t.i,u=t.i;s&&(i=new o(3*r));var f=function(e){var t=i.length;if(e>t){var n=new o(Math.max(2*t,e));n.set(i),i=n}},m=t.f||0,y=t.p||0,g=t.b||0,b=t.l,w=t.d,k=t.m,x=t.n,D=8*r;do{if(!b){m=N(e,y,1);var I=N(e,y+1,3);if(y+=3,I){if(1==I)b=T,w=A,k=9,x=5;else if(2==I){var L=N(e,y,31)+257,P=N(e,y+10,15)+4,_=L+N(e,y+5,31)+1;y+=14;for(var F=new o(_),H=new o(19),U=0;U<P;++U)H[h[U]]=N(e,y+3*U,7);y+=3*P;for(var V=M(H),z=(1<<V)-1,j=E(H,V,1),U=0;U<_;){var K=j[N(e,y,z)];y+=15&K;var B=K>>4;if(B<16)F[U++]=B;else{var G=0,X=0;for(16==B?(X=3+N(e,y,3),y+=2,G=F[U-1]):17==B?(X=3+N(e,y,7),y+=3):18==B&&(X=11+N(e,y,127),y+=7);X--;)F[U++]=G}}var W=F.subarray(0,L),q=F.subarray(L);k=M(W),x=M(q),b=E(W,k,1),w=E(q,x,1)}else S(1)}else{var B=R(y)+4,J=e[B-4]|e[B-3]<<8,Z=B+J;if(Z>r){u&&S(0);break}d&&f(g+J),i.set(e.subarray(B,Z),g),t.b=g+=J,t.p=y=8*Z,t.f=m;continue}if(y>D){u&&S(0);break}}d&&f(g+131072);for(var Y=(1<<k)-1,$=(1<<x)-1,Q=y;;Q=y){var G=b[C(e,y)&Y],ee=G>>4;if((y+=15&G)>D){u&&S(0);break}if(G||S(2),ee<256)i[g++]=ee;else if(256==ee){Q=y,b=null;break}else{var et=ee-254;if(ee>264){var U=ee-257,ei=l[U];et=N(e,y,(1<<ei)-1)+p[U],y+=ei}var en=w[C(e,y)&$],er=en>>4;en||S(3),y+=15&en;var q=v[er];if(er>3){var ei=c[er];q+=C(e,y)&(1<<ei)-1,y+=ei}if(y>D){u&&S(0);break}d&&f(g+131072);var eo=g+et;if(g<q){var ea=a-q,es=Math.min(q,eo);for(ea+g<0&&S(3);g<es;++g)i[g]=n[ea+g]}for(;g<eo;++g)i[g]=i[g-q]}}t.l=b,t.p=Q,t.b=g,t.f=m,b&&(m=1,t.m=k,t.d=w,t.n=x)}while(!m);return g!=i.length&&s?O(i,0,g):i.subarray(0,g)},L=function(e,t,i){i<<=7&t;var n=t/8|0;e[n]|=i,e[n+1]|=i>>8},P=function(e,t,i){i<<=7&t;var n=t/8|0;e[n]|=i,e[n+1]|=i>>8,e[n+2]|=i>>16},_=function(e,t){for(var i=[],n=0;n<e.length;++n)e[n]&&i.push({s:n,f:e[n]});var r=i.length,s=i.slice();if(!r)return{t:K,l:0};if(1==r){var l=new o(i[0].s+1);return l[i[0].s]=1,{t:l,l:1}}i.sort(function(e,t){return e.f-t.f}),i.push({s:-1,f:25001});var c=i[0],h=i[1],d=0,u=1,p=2;for(i[0]={s:-1,f:c.f+h.f,l:c,r:h};u!=r-1;)c=i[i[d].f<i[p].f?d++:p++],h=i[d!=u&&i[d].f<i[p].f?d++:p++],i[u++]={s:-1,f:c.f+h.f,l:c,r:h};for(var f=s[0].s,n=1;n<r;++n)s[n].s>f&&(f=s[n].s);var m=new a(f+1),v=F(i[u-1],m,0);if(v>t){var n=0,y=0,g=v-t,b=1<<g;for(s.sort(function(e,t){return m[t.s]-m[e.s]||e.f-t.f});n<r;++n){var w=s[n].s;if(m[w]>t)y+=b-(1<<v-m[w]),m[w]=t;else break}for(y>>=g;y>0;){var E=s[n].s;m[E]<t?y-=1<<t-m[E]++-1:++n}for(;n>=0&&y;--n){var k=s[n].s;m[k]==t&&(--m[k],++y)}v=t}return{t:new o(m),l:v}},F=function(e,t,i){return -1==e.s?Math.max(F(e.l,t,i+1),F(e.r,t,i+1)):t[e.s]=i},H=function(e){for(var t=e.length;t&&!e[--t];);for(var i=new a(++t),n=0,r=e[0],o=1,s=function(e){i[n++]=e},l=1;l<=t;++l)if(e[l]==r&&l!=t)++o;else{if(!r&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(r),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(r);o=1,r=e[l]}return{c:i.subarray(0,n),n:t}},U=function(e,t){for(var i=0,n=0;n<t.length;++n)i+=e[n]*t[n];return i},V=function(e,t,i){var n=i.length,r=R(t+2);e[r]=255&n,e[r+1]=n>>8,e[r+2]=255^e[r],e[r+3]=255^e[r+1];for(var o=0;o<n;++o)e[r+o+4]=i[o];return(r+4+n)*8},z=function(e,t,i,n,r,o,s,d,u,p,f){L(t,f++,i),++r[256];for(var m,v,y,g,b=_(r,15),w=b.t,T=b.l,A=_(o,15),M=A.t,N=A.l,C=H(w),R=C.c,O=C.n,D=H(M),S=D.c,I=D.n,F=new a(19),z=0;z<R.length;++z)++F[31&R[z]];for(var z=0;z<S.length;++z)++F[31&S[z]];for(var j=_(F,7),K=j.t,B=j.l,G=19;G>4&&!K[h[G-1]];--G);var X=p+5<<3,W=U(r,k)+U(o,x)+s,q=U(r,w)+U(o,M)+s+14+3*G+U(F,K)+2*F[16]+3*F[17]+7*F[18];if(u>=0&&X<=W&&X<=q)return V(t,f,e.subarray(u,u+p));if(L(t,f,1+(q<W)),f+=2,q<W){m=E(w,T,0),v=w,y=E(M,N,0),g=M;var J=E(K,B,0);L(t,f,O-257),L(t,f+5,I-1),L(t,f+10,G-4),f+=14;for(var z=0;z<G;++z)L(t,f+3*z,K[h[z]]);f+=3*G;for(var Z=[R,S],Y=0;Y<2;++Y)for(var $=Z[Y],z=0;z<$.length;++z){var Q=31&$[z];L(t,f,J[Q]),f+=K[Q],Q>15&&(L(t,f,$[z]>>5&127),f+=$[z]>>12)}}else m=null,v=k,y=null,g=x;for(var z=0;z<d;++z){var ee=n[z];if(ee>255){var Q=ee>>18&31;P(t,f,m[Q+257]),f+=v[Q+257],Q>7&&(L(t,f,ee>>23&31),f+=l[Q]);var et=31&ee;P(t,f,y[et]),f+=g[et],et>3&&(P(t,f,ee>>5&8191),f+=c[et])}else P(t,f,m[ee]),f+=v[ee]}return P(t,f,m[256]),f+v[256]},j=new s([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),K=new o(0),B=function(e,t,i,n,r,h){var d=h.z||e.length,u=new o(n+d+5*(1+Math.ceil(d/7e3))+r),p=u.subarray(n,u.length-r),m=h.l,v=7&(h.r||0);if(t){v&&(p[0]=h.r>>3);for(var g=j[t-1],b=g>>13,w=8191&g,E=(1<<i)-1,k=h.p||new a(32768),x=h.h||new a(E+1),T=Math.ceil(i/3),A=2*T,M=function(t){return(e[t]^e[t+1]<<T^e[t+2]<<A)&E},N=new s(25e3),C=new a(288),D=new a(32),S=0,I=0,L=h.i||0,P=0,_=h.w||0,F=0;L+2<d;++L){var H=M(L),U=32767&L,K=x[H];if(k[U]=K,x[H]=U,_<=L){var B=d-L;if((S>7e3||P>24576)&&(B>423||!m)){v=z(e,p,0,N,C,D,I,P,F,L-F,v),P=S=I=0,F=L;for(var G=0;G<286;++G)C[G]=0;for(var G=0;G<30;++G)D[G]=0}var X=2,W=0,q=w,J=U-K&32767;if(B>2&&H==M(L-J))for(var Z=Math.min(b,B)-1,Y=Math.min(32767,L),$=Math.min(258,B);J<=Y&&--q&&U!=K;){if(e[L+X]==e[L+X-J]){for(var Q=0;Q<$&&e[L+Q]==e[L+Q-J];++Q);if(Q>X){if(X=Q,W=J,Q>Z)break;for(var ee=Math.min(J,Q-2),et=0,G=0;G<ee;++G){var ei=L-J+G&32767,en=k[ei],er=ei-en&32767;er>et&&(et=er,K=ei)}}}K=k[U=K],J+=U-K&32767}if(W){N[P++]=268435456|f[X]<<18|y[W];var eo=31&f[X],ea=31&y[W];I+=l[eo]+c[ea],++C[257+eo],++D[ea],_=L+X,++S}else N[P++]=e[L],++C[e[L]]}}for(L=Math.max(L,_);L<d;++L)N[P++]=e[L],++C[e[L]];v=z(e,p,m,N,C,D,I,P,F,L-F,v),m||(h.r=7&v|p[v/8|0]<<3,v-=7,h.h=x,h.p=k,h.i=L,h.w=_)}else{for(var L=h.w||0;L<d+m;L+=65535){var es=L+65535;es>=d&&(p[v/8|0]=m,es=d),v=V(p,v+1,e.subarray(L,es))}h.i=d}return O(u,0,n+R(v)+r)};function G(e,t){var i;return I(e.subarray((i=t&&t.dictionary,((15&e[0])!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&S(6,"invalid zlib data"),(e[1]>>5&1)==+!i&&S(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),(e[1]>>3&4)+2),-4),{i:2},t&&t.out,t&&t.dictionary)}var X="undefined"!=typeof TextDecoder&&new TextDecoder;try{X.decode(K,{stream:!0})}catch(e){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;class W extends n.yxD{constructor(e){super(e),this.type=n.cLu,this.outputFormat=n.wk1}parse(e){let t={l:0,c:0,lc:0};function i(e,i,n,r,o){for(;n<e;)i=i<<8|O(r,o),n+=8;n-=e,t.l=i>>n&(1<<e)-1,t.c=i,t.lc=n}let r=Array(59),o={c:0,lc:0};function a(e,t,i,n){e=e<<8|O(i,n),t+=8,o.c=e,o.lc=t}let s={c:0,lc:0};function l(e,t,i,n,r,l,c,h,d){if(e==t){n<8&&(a(i,n,r,l),i=o.c,n=o.lc);let e=i>>(n-=8);if(e=new Uint8Array([e])[0],h.value+e>d)return!1;let t=c[h.value-1];for(;e-- >0;)c[h.value++]=t}else{if(!(h.value<d))return!1;c[h.value++]=e}s.c=i,s.lc=n}function c(e){let t=65535&e;return t>32767?t-65536:t}let h={a:0,b:0};function d(e,t){let i=c(e),n=c(t),r=i+(1&n)+(n>>1),o=r-n;h.a=r,h.b=o}function u(e,t){let i=65535&t,n=(65535&e)-(i>>1)&65535;h.a=i+n-32768&65535,h.b=n}function p(e,n,c,h,d,u){let p=c.value,f=R(n,c),m=R(n,c);c.value+=4;let v=R(n,c);if(c.value+=4,f<0||f>=65537||m<0||m>=65537)throw Error("Something wrong with HUF_ENCSIZE");let y=Array(65537),g=Array(16384);!function(e){for(let t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(g);let b=h-(c.value-p);if(!function(e,n,o,a,s,l){let c=0,h=0;for(;a<=s;a++){if(n.value-n.value>o)return!1;i(6,c,h,e,n);let r=t.l;if(c=t.c,h=t.lc,l[a]=r,63==r){if(n.value-n.value>o)throw Error("Something wrong with hufUnpackEncTable");i(8,c,h,e,n);let r=t.l+6;if(c=t.c,h=t.lc,a+r>s+1)throw Error("Something wrong with hufUnpackEncTable");for(;r--;)l[a++]=0;a--}else if(r>=59){let e=r-59+2;if(a+e>s+1)throw Error("Something wrong with hufUnpackEncTable");for(;e--;)l[a++]=0;a--}}!function(e){for(let e=0;e<=58;++e)r[e]=0;for(let t=0;t<65537;++t)r[e[t]]+=1;let t=0;for(let e=58;e>0;--e){let i=t+r[e]>>1;r[e]=t,t=i}for(let t=0;t<65537;++t){let i=e[t];i>0&&(e[t]=i|r[i]++<<6)}}(l)}(e,c,b,f,m,y),v>8*(h-(c.value-p)))throw Error("Something wrong with hufUncompress");!function(e,t,i,n){for(;t<=i;t++){let i=e[t]>>6,r=63&e[t];if(i>>r)throw Error("Invalid table entry");if(r>14){let e=n[i>>r-14];if(e.len)throw Error("Invalid table entry");if(e.lit++,e.p){let t=e.p;e.p=Array(e.lit);for(let i=0;i<e.lit-1;++i)e.p[i]=t[i]}else e.p=[,];e.p[e.lit-1]=t}else if(r){let e=0;for(let o=1<<14-r;o>0;o--){let o=n[(i<<14-r)+e];if(o.len||o.p)throw Error("Invalid table entry");o.len=r,o.lit=t,e++}}}}(y,f,m,g),function(e,t,i,n,r,c,h,d,u){let p=0,f=0,m=Math.trunc(n.value+(r+7)/8);for(;n.value<m;)for(a(p,f,i,n),p=o.c,f=o.lc;f>=14;){let r=t[p>>f-14&16383];if(r.len)f-=r.len,l(r.lit,c,p,f,i,n,d,u,h),p=s.c,f=s.lc;else{let t;if(!r.p)throw Error("hufDecode issues");for(t=0;t<r.lit;t++){let v=63&e[r.p[t]];for(;f<v&&n.value<m;)a(p,f,i,n),p=o.c,f=o.lc;if(f>=v&&e[r.p[t]]>>6==(p>>f-v&(1<<v)-1)){f-=v,l(r.p[t],c,p,f,i,n,d,u,h),p=s.c,f=s.lc;break}}if(t==r.lit)throw Error("hufDecode issues")}}let v=8-r&7;for(p>>=v,f-=v;f>0;){let e=t[p<<14-f&16383];if(e.len)f-=e.len,l(e.lit,c,p,f,i,n,d,u,h),p=s.c,f=s.lc;else throw Error("hufDecode issues")}}(y,g,e,c,v,m,u,d,{value:0})}function f(e){for(let t=1;t<e.length;t++){let i=e[t-1]+e[t]-128;e[t]=i}}function m(e,t){let i=0,n=Math.floor((e.length+1)/2),r=0,o=e.length-1;for(;!(r>o)&&(t[r++]=e[i++],!(r>o));)t[r++]=e[n++]}function v(e){let t=e.byteLength,i=[],n=0,r=new DataView(e);for(;t>0;){let e=r.getInt8(n++);if(e<0){let o=-e;t-=o+1;for(let e=0;e<o;e++)i.push(r.getUint8(n++))}else{t-=2;let o=r.getUint8(n++);for(let t=0;t<e+1;t++)i.push(o)}}return i}function y(e,t,i){let n;let r=1;for(;r<64;)65280==(n=t[e.value])?r=64:n>>8==255?r+=255&n:(i[r]=n,r++),e.value++}function g(e,t){t[0]=P(e[0]),t[1]=P(e[1]),t[2]=P(e[5]),t[3]=P(e[6]),t[4]=P(e[14]),t[5]=P(e[15]),t[6]=P(e[27]),t[7]=P(e[28]),t[8]=P(e[2]),t[9]=P(e[4]),t[10]=P(e[7]),t[11]=P(e[13]),t[12]=P(e[16]),t[13]=P(e[26]),t[14]=P(e[29]),t[15]=P(e[42]),t[16]=P(e[3]),t[17]=P(e[8]),t[18]=P(e[12]),t[19]=P(e[17]),t[20]=P(e[25]),t[21]=P(e[30]),t[22]=P(e[41]),t[23]=P(e[43]),t[24]=P(e[9]),t[25]=P(e[11]),t[26]=P(e[18]),t[27]=P(e[24]),t[28]=P(e[31]),t[29]=P(e[40]),t[30]=P(e[44]),t[31]=P(e[53]),t[32]=P(e[10]),t[33]=P(e[19]),t[34]=P(e[23]),t[35]=P(e[32]),t[36]=P(e[39]),t[37]=P(e[45]),t[38]=P(e[52]),t[39]=P(e[54]),t[40]=P(e[20]),t[41]=P(e[22]),t[42]=P(e[33]),t[43]=P(e[38]),t[44]=P(e[46]),t[45]=P(e[51]),t[46]=P(e[55]),t[47]=P(e[60]),t[48]=P(e[21]),t[49]=P(e[34]),t[50]=P(e[37]),t[51]=P(e[47]),t[52]=P(e[50]),t[53]=P(e[56]),t[54]=P(e[59]),t[55]=P(e[61]),t[56]=P(e[35]),t[57]=P(e[36]),t[58]=P(e[48]),t[59]=P(e[49]),t[60]=P(e[57]),t[61]=P(e[58]),t[62]=P(e[62]),t[63]=P(e[63])}function b(e){let t=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(3*3.14159/8),n=[,,,,],r=[,,,,],o=[,,,,],a=[,,,,];for(let s=0;s<8;++s){let l=8*s;n[0]=.4619398297234211*e[l+2],n[1]=i*e[l+2],n[2]=.4619398297234211*e[l+6],n[3]=i*e[l+6],r[0]=.4903926563794112*e[l+1]+t*e[l+3]+.2777854612564676*e[l+5]+.09754573032714427*e[l+7],r[1]=t*e[l+1]-.09754573032714427*e[l+3]-.4903926563794112*e[l+5]-.2777854612564676*e[l+7],r[2]=.2777854612564676*e[l+1]-.4903926563794112*e[l+3]+.09754573032714427*e[l+5]+t*e[l+7],r[3]=.09754573032714427*e[l+1]-.2777854612564676*e[l+3]+t*e[l+5]-.4903926563794112*e[l+7],o[0]=.35355362513961314*(e[l+0]+e[l+4]),o[3]=.35355362513961314*(e[l+0]-e[l+4]),o[1]=n[0]+n[3],o[2]=n[1]-n[2],a[0]=o[0]+o[1],a[1]=o[3]+o[2],a[2]=o[3]-o[2],a[3]=o[0]-o[1],e[l+0]=a[0]+r[0],e[l+1]=a[1]+r[1],e[l+2]=a[2]+r[2],e[l+3]=a[3]+r[3],e[l+4]=a[3]-r[3],e[l+5]=a[2]-r[2],e[l+6]=a[1]-r[1],e[l+7]=a[0]-r[0]}for(let s=0;s<8;++s)n[0]=.4619398297234211*e[16+s],n[1]=i*e[16+s],n[2]=.4619398297234211*e[48+s],n[3]=i*e[48+s],r[0]=.4903926563794112*e[8+s]+t*e[24+s]+.2777854612564676*e[40+s]+.09754573032714427*e[56+s],r[1]=t*e[8+s]-.09754573032714427*e[24+s]-.4903926563794112*e[40+s]-.2777854612564676*e[56+s],r[2]=.2777854612564676*e[8+s]-.4903926563794112*e[24+s]+.09754573032714427*e[40+s]+t*e[56+s],r[3]=.09754573032714427*e[8+s]-.2777854612564676*e[24+s]+t*e[40+s]-.4903926563794112*e[56+s],o[0]=.35355362513961314*(e[s]+e[32+s]),o[3]=.35355362513961314*(e[s]-e[32+s]),o[1]=n[0]+n[3],o[2]=n[1]-n[2],a[0]=o[0]+o[1],a[1]=o[3]+o[2],a[2]=o[3]-o[2],a[3]=o[0]-o[1],e[0+s]=a[0]+r[0],e[8+s]=a[1]+r[1],e[16+s]=a[2]+r[2],e[24+s]=a[3]+r[3],e[32+s]=a[3]-r[3],e[40+s]=a[2]-r[2],e[48+s]=a[1]-r[1],e[56+s]=a[0]-r[0]}function w(e,t,i){for(let o=0;o<64;++o){var r;t[i+o]=n.A5E.toHalfFloat((r=e[o])<=1?Math.sign(r)*Math.pow(Math.abs(r),2.2):Math.sign(r)*Math.pow(9.025013291561939,Math.abs(r)-1))}}function E(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function k(e){let t=new Uint8Array(v(e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size))),i=new Uint8Array(t.length);return f(t),m(t,i),new DataView(i.buffer)}function x(e){let t=G(e.array.slice(e.offset.value,e.offset.value+e.size)),i=new Uint8Array(t.length);return f(t),m(t,i),new DataView(i.buffer)}function T(e){let t=e.viewer,i={value:e.offset.value},n=new Uint16Array(e.columns*e.lines*(e.inputChannels.length*e.type)),r=new Uint8Array(8192),o=0,a=Array(e.inputChannels.length);for(let t=0,i=e.inputChannels.length;t<i;t++)a[t]={},a[t].start=o,a[t].end=a[t].start,a[t].nx=e.columns,a[t].ny=e.lines,a[t].size=e.type,o+=a[t].nx*a[t].ny*a[t].size;let s=_(t,i),l=_(t,i);if(l>=8192)throw Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(s<=l)for(let e=0;e<l-s+1;e++)r[e+s]=D(t,i);let c=new Uint16Array(65536),f=function(e,t){let i=0;for(let n=0;n<65536;++n)(0==n||e[n>>3]&1<<(7&n))&&(t[i++]=n);let n=i-1;for(;i<65536;)t[i++]=0;return n}(r,c),m=R(t,i);p(e.array,t,i,m,n,o);for(let t=0;t<e.inputChannels.length;++t){let e=a[t];for(let i=0;i<a[t].size;++i)!function(e,t,i,n,r,o,a){let s,l;let c=a<16384,p=i>r?r:i,f=1;for(;f<=p;)f<<=1;for(f>>=1,s=f,f>>=1;f>=1;){let a,p,m,v;let y=(l=0)+o*(r-s),g=o*f,b=o*s,w=n*f,E=n*s;for(;l<=y;l+=b){let r=l,o=l+n*(i-s);for(;r<=o;r+=E){let i=r+w,n=r+g,o=n+w;c?(d(e[r+t],e[n+t]),a=h.a,m=h.b,d(e[i+t],e[o+t]),p=h.a,v=h.b,d(a,p),e[r+t]=h.a,e[i+t]=h.b,d(m,v)):(u(e[r+t],e[n+t]),a=h.a,m=h.b,u(e[i+t],e[o+t]),p=h.a,v=h.b,u(a,p),e[r+t]=h.a,e[i+t]=h.b,u(m,v)),e[n+t]=h.a,e[o+t]=h.b}if(i&f){let i=r+g;c?d(e[r+t],e[i+t]):u(e[r+t],e[i+t]),a=h.a,e[i+t]=h.b,e[r+t]=a}}if(r&f){let r=l,o=l+n*(i-s);for(;r<=o;r+=E){let i=r+w;c?d(e[r+t],e[i+t]):u(e[r+t],e[i+t]),a=h.a,e[i+t]=h.b,e[r+t]=a}}s=f,f>>=1}}(n,e.start+i,e.nx,e.size,e.ny,e.nx*e.size,f)}!function(e,t,i){for(let n=0;n<i;++n)t[n]=e[t[n]]}(c,n,o);let v=0,y=new Uint8Array(n.buffer.byteLength);for(let t=0;t<e.lines;t++)for(let t=0;t<e.inputChannels.length;t++){let e=a[t],i=e.nx*e.size,r=new Uint8Array(n.buffer,2*e.end,2*i);y.set(r,v),v+=2*i,e.end+=i}return new DataView(y.buffer)}function A(e){let t=G(e.array.slice(e.offset.value,e.offset.value+e.size)),i=new DataView(new ArrayBuffer(e.inputChannels.length*e.lines*e.columns*e.totalBytes)),n=0,r=0,o=[,,,,];for(let a=0;a<e.lines;a++)for(let a=0;a<e.inputChannels.length;a++){let s=0;switch(e.inputChannels[a].pixelType){case 1:o[0]=n,o[1]=o[0]+e.columns,n=o[1]+e.columns;for(let n=0;n<e.columns;++n)s+=t[o[0]++]<<8|t[o[1]++],i.setUint16(r,s,!0),r+=2;break;case 2:o[0]=n,o[1]=o[0]+e.columns,o[2]=o[1]+e.columns,n=o[2]+e.columns;for(let n=0;n<e.columns;++n)s+=t[o[0]++]<<24|t[o[1]++]<<16|t[o[2]++]<<8,i.setUint32(r,s,!0),r+=4}}return i}function M(e){let t,i,n;let r=e.viewer,o={value:e.offset.value},a=new Uint8Array(e.columns*e.lines*(e.inputChannels.length*e.type*2)),s={version:S(r,o),unknownUncompressedSize:S(r,o),unknownCompressedSize:S(r,o),acCompressedSize:S(r,o),dcCompressedSize:S(r,o),rleCompressedSize:S(r,o),rleUncompressedSize:S(r,o),rleRawSize:S(r,o),totalAcUncompressedCount:S(r,o),totalDcUncompressedCount:S(r,o),acCompression:S(r,o)};if(s.version<2)throw Error("EXRLoader.parse: "+B.compression+" version "+s.version+" is unsupported");let l=[],c=_(r,o)-2;for(;c>0;){let e=N(r.buffer,o),t=D(r,o),i=t>>2&3,n=new Int8Array([(t>>4)-1])[0],a=D(r,o);l.push({name:e,index:n,type:a,compression:i}),c-=e.length+3}let h=B.channels,d=Array(e.inputChannels.length);for(let t=0;t<e.inputChannels.length;++t){let i=d[t]={},n=h[t];i.name=n.name,i.compression=0,i.decoded=!1,i.type=n.pixelType,i.pLinear=n.pLinear,i.width=e.columns,i.height=e.lines}let u={idx:[,,,]};for(let t=0;t<e.inputChannels.length;++t){let e=d[t];for(let i=0;i<l.length;++i){let n=l[i];e.name==n.name&&(e.compression=n.compression,n.index>=0&&(u.idx[n.index]=t),e.offset=t)}}if(s.acCompressedSize>0)switch(s.acCompression){case 0:t=new Uint16Array(s.totalAcUncompressedCount),p(e.array,r,o,s.acCompressedSize,t,s.totalAcUncompressedCount);break;case 1:t=new Uint16Array(G(e.array.slice(o.value,o.value+s.totalAcUncompressedCount)).buffer),o.value+=s.totalAcUncompressedCount}s.dcCompressedSize>0&&(i=new Uint16Array(x({array:e.array,offset:o,size:s.dcCompressedSize}).buffer),o.value+=s.dcCompressedSize),s.rleRawSize>0&&(n=v(G(e.array.slice(o.value,o.value+s.rleCompressedSize)).buffer),o.value+=s.rleCompressedSize);let f=0,m=Array(d.length);for(let e=0;e<m.length;++e)m[e]=[];for(let t=0;t<e.lines;++t)for(let t=0;t<d.length;++t)m[t].push(f),f+=d[t].width*e.type*2;void 0!==u.idx[0]&&d[u.idx[0]]&&function(e,t,i,n,r,o){let a=new DataView(o.buffer),s=i[e.idx[0]].width,l=i[e.idx[0]].height,c=Math.floor(s/8),h=Math.ceil(s/8),d=Math.ceil(l/8),u=s-(h-1)*8,p=l-(d-1)*8,f={value:0},m=[,,,],v=[,,,],E=[,,,],k=[,,,],x=[,,,];for(let i=0;i<3;++i)x[i]=t[e.idx[i]],m[i]=i<1?0:m[i-1]+h*d,v[i]=new Float32Array(64),E[i]=new Uint16Array(64),k[i]=new Uint16Array(64*h);for(let t=0;t<d;++t){let o=8;t==d-1&&(o=p);let s=8;for(let e=0;e<h;++e){e==h-1&&(s=u);for(let e=0;e<3;++e)E[e].fill(0),E[e][0]=r[m[e]++],y(f,n,E[e]),g(E[e],v[e]),b(v[e]);!function(e){for(let t=0;t<64;++t){let i=e[0][t],n=e[1][t],r=e[2][t];e[0][t]=i+1.5747*r,e[1][t]=i-.1873*n-.4682*r,e[2][t]=i+1.8556*n}}(v);for(let t=0;t<3;++t)w(v[t],k[t],64*e)}let l=0;for(let n=0;n<3;++n){let r=i[e.idx[n]].type;for(let e=8*t;e<8*t+o;++e){l=x[n][e];for(let t=0;t<c;++t){let i=64*t+(7&e)*8;a.setUint16(l+0*r,k[n][i+0],!0),a.setUint16(l+2*r,k[n][i+1],!0),a.setUint16(l+4*r,k[n][i+2],!0),a.setUint16(l+6*r,k[n][i+3],!0),a.setUint16(l+8*r,k[n][i+4],!0),a.setUint16(l+10*r,k[n][i+5],!0),a.setUint16(l+12*r,k[n][i+6],!0),a.setUint16(l+14*r,k[n][i+7],!0),l+=16*r}}if(c!=h)for(let e=8*t;e<8*t+o;++e){let t=x[n][e]+8*c*2*r,i=64*c+(7&e)*8;for(let e=0;e<s;++e)a.setUint16(t+2*e*r,k[n][i+e],!0)}}}let T=new Uint16Array(s);a=new DataView(o.buffer);for(let t=0;t<3;++t){i[e.idx[t]].decoded=!0;let n=i[e.idx[t]].type;if(2==i[t].type)for(let e=0;e<l;++e){let i=x[t][e];for(let e=0;e<s;++e)T[e]=a.getUint16(i+2*e*n,!0);for(let e=0;e<s;++e)a.setFloat32(i+2*e*n,P(T[e]),!0)}}}(u,m,d,t,i,a);for(let r=0;r<d.length;++r){let o=d[r];if(!o.decoded)switch(o.compression){case 2:let s=0,l=0;for(let t=0;t<e.lines;++t){let e=m[r][s];for(let t=0;t<o.width;++t){for(let t=0;t<2*o.type;++t)a[e++]=n[l+t*o.width*o.height];l++}s++}break;case 1:!function(e,t,i,n,r,o){let a=new DataView(o.buffer),s=i[e],l=s.width,c=s.height,h=Math.ceil(l/8),d=Math.ceil(c/8),u=Math.floor(l/8),p=l-(h-1)*8,f=c-(d-1)*8,m={value:0},v=0,E=new Float32Array(64),k=new Uint16Array(64),x=new Uint16Array(64*h);for(let i=0;i<d;++i){let o=8;i==d-1&&(o=f);for(let e=0;e<h;++e)k.fill(0),k[0]=r[v++],y(m,n,k),g(k,E),b(E),w(E,x,64*e);for(let n=8*i;n<8*i+o;++n){let i=t[e][n];for(let e=0;e<u;++e){let t=64*e+(7&n)*8;for(let e=0;e<8;++e)a.setUint16(i+2*e*s.type,x[t+e],!0);i+=16*s.type}if(h!=u){let e=64*u+(7&n)*8;for(let t=0;t<p;++t)a.setUint16(i+2*t*s.type,x[e+t],!0)}}}s.decoded=!0}(r,m,d,t,i,a);break;default:throw Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(a.buffer)}function N(e,t){let i=new Uint8Array(e),n=0;for(;0!=i[t.value+n];)n+=1;let r=new TextDecoder().decode(i.slice(t.value,t.value+n));return t.value=t.value+n+1,r}function C(e,t){let i=e.getInt32(t.value,!0);return t.value=t.value+4,i}function R(e,t){let i=e.getUint32(t.value,!0);return t.value=t.value+4,i}function O(e,t){let i=e[t.value];return t.value=t.value+1,i}function D(e,t){let i=e.getUint8(t.value);return t.value=t.value+1,i}let S=function(e,t){let i;return"getBigInt64"in DataView.prototype?i=Number(e.getBigInt64(t.value,!0)):i=e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,i};function I(e,t){let i=e.getFloat32(t.value,!0);return t.value+=4,i}function L(e,t){return n.A5E.toHalfFloat(I(e,t))}function P(e){let t=(31744&e)>>10,i=1023&e;return(e>>15?-1:1)*(t?31===t?i?NaN:1/0:Math.pow(2,t-15)*(1+i/1024):i/1024*6103515625e-14)}function _(e,t){let i=e.getUint16(t.value,!0);return t.value+=2,i}function F(e,t){return P(_(e,t))}function H(e,t,i,n){let r=Array(e);for(let o=0;o<e;o++){let e=1<<o,a=t/e|0;"ROUND_UP"==n&&a*e<t&&(a+=1);let s=Math.max(a,1);r[o]=(s+i-1)/i|0}return r}function U(){let e=this.offset,t={value:0};for(let i=0;i<this.tileCount;i++){let i=C(this.viewer,e),n=C(this.viewer,e);e.value+=8,this.size=R(this.viewer,e);let r=i*this.blockWidth,o=n*this.blockHeight;this.columns=r+this.blockWidth>this.width?this.width-r:this.blockWidth,this.lines=o+this.blockHeight>this.height?this.height-o:this.blockHeight;let a=this.columns*this.totalBytes,s=this.size<this.lines*a?this.uncompress(this):E(this);e.value+=this.size;for(let e=0;e<this.lines;e++){let i=e*this.columns*this.totalBytes;for(let n=0;n<this.inputChannels.length;n++){let a=B.channels[n].name,l=this.channelByteOffsets[a]*this.columns,c=this.decodeChannels[a];if(void 0===c)continue;t.value=i+l;let h=(this.height-(1+o+e))*this.outLineWidth;for(let e=0;e<this.columns;e++){let i=h+(e+r)*this.outputChannels+c;this.byteArray[i]=this.getter(s,t)}}}}}function V(){let e=this.offset,t={value:0};for(let i=0;i<this.height/this.blockHeight;i++){let n=C(this.viewer,e)-B.dataWindow.yMin;this.size=R(this.viewer,e),this.lines=n+this.blockHeight>this.height?this.height-n:this.blockHeight;let r=this.columns*this.totalBytes,o=this.size<this.lines*r?this.uncompress(this):E(this);e.value+=this.size;for(let e=0;e<this.blockHeight;e++){let n=i*this.blockHeight,a=e+this.scanOrder(n);if(a>=this.height)continue;let s=e*r,l=(this.height-1-a)*this.outLineWidth;for(let e=0;e<this.inputChannels.length;e++){let i=B.channels[e].name,n=this.channelByteOffsets[i]*this.columns,r=this.decodeChannels[i];if(void 0!==r){t.value=s+n;for(let e=0;e<this.columns;e++){let i=l+e*this.outputChannels+r;this.byteArray[i]=this.getter(o,t)}}}}}}let z={value:0},j=new DataView(e),K=new Uint8Array(e),B=function(e,t,i){let n={};if(20000630!=e.getUint32(0,!0))throw Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");n.version=e.getUint8(4);let r=e.getUint8(5);n.spec={singleTile:!!(2&r),longName:!!(4&r),deepFormat:!!(8&r),multiPart:!!(16&r)},i.value=8;let o=!0;for(;o;){let r=N(t,i);if(""===r)o=!1;else{let o=N(t,i),a=R(e,i),s=function(e,t,i,n,r){if("string"===n||"stringvector"===n||"iccProfile"===n)return function(e,t,i){let n=new TextDecoder().decode(new Uint8Array(e).slice(t.value,t.value+i));return t.value=t.value+i,n}(t,i,r);if("chlist"===n)return function(e,t,i,n){let r=i.value,o=[];for(;i.value<r+n-1;){let n=N(t,i),r=C(e,i),a=D(e,i);i.value+=3;let s=C(e,i),l=C(e,i);o.push({name:n,pixelType:r,pLinear:a,xSampling:s,ySampling:l})}return i.value+=1,o}(e,t,i,r);if("chromaticities"===n)return function(e,t){let i=I(e,t),n=I(e,t),r=I(e,t),o=I(e,t),a=I(e,t);return{redX:i,redY:n,greenX:r,greenY:o,blueX:a,blueY:I(e,t),whiteX:I(e,t),whiteY:I(e,t)}}(e,i);if("compression"===n)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][D(e,i)];if("box2i"===n)return function(e,t){let i=C(e,t);return{xMin:i,yMin:C(e,t),xMax:C(e,t),yMax:C(e,t)}}(e,i);if("envmap"===n)return["ENVMAP_LATLONG","ENVMAP_CUBE"][D(e,i)];if("tiledesc"===n)return function(e,t){let i=R(e,t),n=R(e,t),r=D(e,t);return{xSize:i,ySize:n,levelMode:["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"][15&r],roundingMode:["ROUND_DOWN","ROUND_UP"][r>>4]}}(e,i);if("lineOrder"===n)return["INCREASING_Y","DECREASING_Y","RANDOM_Y"][D(e,i)];if("float"===n)return I(e,i);if("v2f"===n)return[I(e,i),I(e,i)];if("v3f"===n){var o,a;return[I(o=e,a=i),I(o,a),I(o,a)]}return"int"===n?C(e,i):"rational"===n?[C(e,i),R(e,i)]:"timecode"===n?[R(e,i),R(e,i)]:"preview"===n?(i.value+=r,"skipped"):void(i.value+=r)}(e,t,i,o,a);void 0===s?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${o}'.`):n[r]=s}}if((-7&r)!=0)throw console.error("THREE.EXRHeader:",n),Error("THREE.EXRLoader: Provided file is currently unsupported.");return n}(j,e,z),X=function(e,t,i,r,o,a){let s={size:0,viewer:t,array:i,offset:r,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,inputChannels:e.channels,channelByteOffsets:{},shouldExpand:!1,scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:n.GUF};switch(e.compression){case"NO_COMPRESSION":s.blockHeight=1,s.uncompress=E;break;case"RLE_COMPRESSION":s.blockHeight=1,s.uncompress=k;break;case"ZIPS_COMPRESSION":s.blockHeight=1,s.uncompress=x;break;case"ZIP_COMPRESSION":s.blockHeight=16,s.uncompress=x;break;case"PIZ_COMPRESSION":s.blockHeight=32,s.uncompress=T;break;case"PXR24_COMPRESSION":s.blockHeight=16,s.uncompress=A;break;case"DWAA_COMPRESSION":s.blockHeight=32,s.uncompress=M;break;case"DWAB_COMPRESSION":s.blockHeight=256,s.uncompress=M;break;default:throw Error("EXRLoader.parse: "+e.compression+" is unsupported")}let l={};for(let t of e.channels)switch(t.name){case"Y":case"R":case"G":case"B":case"A":l[t.name]=!0,s.type=t.pixelType}let c=!1,h=!1;if(l.R&&l.G&&l.B)s.outputChannels=4;else if(l.Y)s.outputChannels=1;else throw Error("EXRLoader.parse: file contains unsupported data channels.");switch(s.outputChannels){case 4:a==n.wk1?(c=!l.A,s.format=n.wk1,s.colorSpace=n.GUF,s.outputChannels=4,s.decodeChannels={R:0,G:1,B:2,A:3}):a==n.av9?(s.format=n.av9,s.colorSpace=n.GUF,s.outputChannels=2,s.decodeChannels={R:0,G:1}):a==n.hEm?(s.format=n.hEm,s.colorSpace=n.GUF,s.outputChannels=1,s.decodeChannels={R:0}):h=!0;break;case 1:a==n.wk1?(c=!0,s.format=n.wk1,s.colorSpace=n.GUF,s.outputChannels=4,s.shouldExpand=!0,s.decodeChannels={Y:0}):a==n.av9?(s.format=n.av9,s.colorSpace=n.GUF,s.outputChannels=2,s.shouldExpand=!0,s.decodeChannels={Y:0}):a==n.hEm?(s.format=n.hEm,s.colorSpace=n.GUF,s.outputChannels=1,s.decodeChannels={Y:0}):h=!0;break;default:h=!0}if(h)throw Error("EXRLoader.parse: invalid output format for specified file.");if(1==s.type)switch(o){case n.VzW:s.getter=F;break;case n.cLu:s.getter=_}else if(2==s.type)switch(o){case n.VzW:s.getter=I;break;case n.cLu:s.getter=L}else throw Error("EXRLoader.parse: unsupported pixelType "+s.type+" for "+e.compression+".");s.columns=s.width;let d=s.width*s.height*s.outputChannels;switch(o){case n.VzW:s.byteArray=new Float32Array(d),c&&s.byteArray.fill(1,0,d);break;case n.cLu:s.byteArray=new Uint16Array(d),c&&s.byteArray.fill(15360,0,d);break;default:console.error("THREE.EXRLoader: unsupported type: ",o)}let u=0;for(let t of e.channels)void 0!==s.decodeChannels[t.name]&&(s.channelByteOffsets[t.name]=u),u+=2*t.pixelType;if(s.totalBytes=u,s.outLineWidth=s.width*s.outputChannels,"INCREASING_Y"===e.lineOrder?s.scanOrder=e=>e:s.scanOrder=e=>s.height-1-e,e.spec.singleTile){s.blockHeight=e.tiles.ySize,s.blockWidth=e.tiles.xSize;let i=function(e,t,i){let n=0;switch(e.levelMode){case"ONE_LEVEL":n=1;break;case"MIPMAP_LEVELS":n=function(e,t){let i=Math.log2(e);return"ROUND_DOWN"==t?Math.floor(i):Math.ceil(i)}(Math.max(t,i),e.roundingMode)+1;break;case"RIPMAP_LEVELS":throw Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return n}(e.tiles,s.width,s.height),n=H(i,s.width,e.tiles.xSize,e.tiles.roundingMode),o=H(i,s.height,e.tiles.ySize,e.tiles.roundingMode);s.tileCount=n[0]*o[0];for(let e=0;e<i;e++)for(let i=0;i<o[e];i++)for(let i=0;i<n[e];i++)S(t,r);s.decode=U.bind(s)}else{s.blockWidth=s.width;let e=Math.ceil(s.height/s.blockHeight);for(let i=0;i<e;i++)S(t,r);s.decode=V.bind(s)}return s}(B,j,K,z,this.type,this.outputFormat);if(X.decode(),X.shouldExpand){let e=X.byteArray;if(this.outputFormat==n.wk1)for(let t=0;t<e.length;t+=4)e[t+2]=e[t+1]=e[t];else if(this.outputFormat==n.av9)for(let t=0;t<e.length;t+=2)e[t+1]=e[t]}return{header:B,width:X.width,height:X.height,data:X.byteArray,format:X.format,colorSpace:X.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}setOutputFormat(e){return this.outputFormat=e,this}load(e,t,i,r){return super.load(e,function(e,i){e.colorSpace=i.colorSpace,e.minFilter=n.wem,e.magFilter=n.wem,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,i)},i,r)}}}}]);